/*!
 App Connect
 Version: 2.0.0-beta.17
 (c) 2023 Wappler.io
 @build 2023-09-28 10:39:27
 */
window.dmx={version:"2.0.0-beta.17",versions:{},config:{mapping:{form:"form","button, input[type=button], input[type=submit], input[type=reset]":"button","input[type=radio]":"radio","input[type=checkbox]":"checkbox","input[type=file][multiple]":"input-file-multiple","input[type=file]":"input-file",input:"input",textarea:"textarea","select[multiple]":"select-multiple",select:"select",".checkbox-group":"checkbox-group",".radio-group":"radio-group"}},noop:()=>{},isset:e=>void 0!==e,array:e=>null!=e?Array.from(e):[],reIgnoreElement:/^(script|style)$/i,rePrefixed:/^dmx-/i,reExpression:/\{\{(.+?)\}\}/,reExpressionReplace:/\{\{(.+?)\}\}/g,reToggleAttribute:/^(checked|selected|disabled|required|hidden|async|autofocus|autoplay|default|defer|multiple|muted|novalidate|open|readonly|reversed|scoped)$/i,reDashAlpha:/-([a-z])/g,reUppercase:/[A-Z]/g,__components:Object.create(null),__attributes:{before:Object.create(null),mounted:Object.create(null)},__formatters:{boolean:Object.create(null),global:Object.create(null),string:Object.create(null),number:Object.create(null),object:Object.create(null),array:Object.create(null),any:Object.create(null)},__adapters:Object.create(null),__actions:Object.create(null),__startup:new Set},window.Element&&!("closest"in Element.prototype)&&(Element.prototype.closest=function(e){let t,r=(this.document||this.ownerDocument).querySelectorAll(e),n=this;do{for(t=r.length;--t>=0&&r.item(t)!==n;);}while(t<0&&(n=n.parentElement));return n}),window.NodeList&&!("forEach"in NodeList.prototype)&&(NodeList.prototype.forEach=Array.prototype.forEach),"function"!=typeof window.queueMicrotask&&(window.queueMicrotask=function(e){Promise.resolve().then(e).catch((e=>setTimeout((()=>{throw e}))))}),window.Node&&!("isConnected"in Node.prototype)&&Object.defineProperty(Node.prototype,"isConnected",{get:function(){return document.contains(this)}}),window.Element&&!("toggleAttribute"in Element.prototype)&&(Element.prototype.toggleAttribute=function(e,t){this.hasAttribute(e)?!0!==t&&this.removeAttribute(e):!1!==t&&this.setAttribute(e,"")}),function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r=/\w*$/,n=/^(?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)Array$/,s=function(e,t){return e===t||e!=e&&t!=t},i=function(e,t){for(var r=e.length;r--;)if(s(e[r][0],t))return r;return-1},a=function(e,t){return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?e["string"==typeof t?"string":"hash"]:e.map;var r,n},o=function(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}};o.prototype={clear:function(){this.__data__=Object.create(null),this.size=0},delete:function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},get:function(e){var t=this.__data__[e];return t===HASH_UNDEFINED?void 0:t},has:function(e){return void 0!==this.__data__[e]},set:function(e,t){return this.size+=this.has(e)?0:1,this.__data__[e]=void 0===t?HASH_UNDEFINED:t,this}};var d=function(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}};d.prototype={clear:function(){this.__data__=[],this.size=0},delete:function(e){var t=this.__data__,r=i(t,e);return!(r<0)&&(r==t.length-1?t.pop():t.splice(r,1),--this.size,!0)},get:function(e){var t=this.__data__,r=i(t,e);return r<0?void 0:t[r][1]},has:function(e){return i(this.__data__,e)>-1},set:function(e,t){var r=this.__data__,n=i(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}};var h=function(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}};h.prototype={clear:function(){this.size=0,this.__data__={hash:new o,map:new Map,string:new o}},delete:function(e){var t=a(this.__data__,e).delete(e);return this.size-=t?1:0,t},get:function(e){return a(this.__data__,e).get(e)},has:function(e){return a(this.__data__,e).has(e)},set:function(e,t){var r=a(this.__data__,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}};var l=function(e){var t=this.__data__=new d(e);this.size=t.size};l.prototype={clear:function(){this.__data__=new d,this.size=0},delete:function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},get:function(e){return this.__data__.get(e)},has:function(e){return this.__data__.has(e)},set:function(e,t){var r=this.__data__;if(r instanceof d){var n=r.__data__;if(n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new h(n)}return r.set(e,t),this.size=r.size,this}};var u=function(t){return e.call(t).slice(8,-1)},c=function(e){return Array.isArray(e)},p=function(e){return null!=e&&"object"==typeof e},f=function(e){var t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},m=function(e){var t=f(e.buffer);return new e.constructor(t,e.byteOffset,e.length)},v=function(e,t){var n,s,i,a,o,d,h=e.constructor;switch(t){case"ArrayBuffer":return f();case"Boolean":case"Date":return new h(+e);case"DataView":return d=f((o=e).buffer),new o.constructor(d,o.byteOffset,o.byteLength);case"Float32Array":case"Float64Array":case"Int8Array":case"Int16Array":case"Int32Array":case"Uint8Array":case"Uint8ClampedArray":case"Uint16Array":case"Uint32Array":return m(e);case"Map":case"Set":return new h;case"Number":case"String":return new h(e);case"RegExp":return(a=new(i=e).constructor(i.source,r.exec(i))).lastIndex=i.lastIndex,a;case"ImageData":return s=m((n=e).data),new n.constructor(s,n.width,n.height)}},y=function(e,r,i,a){var o;if(!p(e))return e;var d,h=u(e);o=c(e)?new(d=e).constructor(d.length):"Object"==h?{}:v(e,h);var f=(a=a||new l).get(e);if(f)return f;if(a.set(e,o),"Map"==h)return e.forEach((function(t,r){o.set(r,y(t,r,e,a))})),o;if("Set"==h)return e.forEach((function(t){o.add(y(t,t,e,a))})),o;if(function(e){return p(e)&&n.test(u(e))}(e))return o;var m=c(e)?void 0:Object.keys(Object(e));return function(e,t){for(var r=-1,n=e.length;++r<n&&!1!==t(e[r],r,e););}(m||e,(function(r,n){m&&(r=e[n=r]),function(e,r,n){if("__proto__"!=r){var i=e[r];t.call(e,r)&&s(i,n)&&(void 0!==n||r in e)||(e[r]=n)}}(o,n,y(r,n,e,a))})),o};dmx.clone=y}(),function(){var e=Object.prototype.hasOwnProperty,t=/^(?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)Array$/,r=function(e){return toString.call(e).slice(8,-1)},n=function(e){return"object"==typeof e&&null!==e},s=function(e,t){var r=e.length;if(r!=t.length)return!1;for(var n=-1;++n<r;){var s=e[n],i=t[n];if(s!==i&&!a(s,i))return!1}return!0},i=function(i,o){var d,h=Array.isArray(i),l=Array.isArray(o),u=h?"Array":r(i),c=l?"Array":r(o),p=u==c;return p&&!("Object"==u)?h||n(d=i)&&t.test(r(d))?s(i,o):function(e,t,r){switch(r){case"DataView":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"ArrayBuffer":return!(e.byteLength!=t.byteLength||!a(new Uint8Array(e),new Uint8Array(t)));case"Boolean":case"Date":case"Number":return function(e,t){return e===t||e!=e&&t!=t}(+e,+t);case"RegExp":case"String":return e==String(t);case"Map":case"Set":return e.size==t.size&&s(Array.from(e),Array.from(t))}}(i,o,u):!!p&&function(t,r){var n=Object.keys(t),s=n.length;if(s!=Object.keys(r).length)return!1;for(var i,o=s;o--;)if(i=n[o],!e.call(r,i))return!1;for(var d=!0;++o<s;){var h=t[i=n[o]],l=r[i];if(h!==l&&!a(h,l)){d=!1;break}}if(d){var u=t.constructor,c=r.constructor;u==c||!("constructor"in t)||!("constructor"in r)||"function"==typeof u&&u instanceof u&&"function"==typeof c&&c instanceof c||(d=!1)}return d}(i,o)},a=function(e,t){return e===t||(null==e||null==t||!n(e)&&!n(t)?e!=e&&t!=t:i(e,t))};dmx.equal=a}(),dmx.createClass=(e,t)=>{const r=function(){e.constructor&&e.constructor.apply(this,arguments)};return t&&t.prototype&&(r.prototype=Object.create(t.prototype)),Object.assign(r.prototype,e),r.prototype.constructor=r,r},dmx.ready=e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{e()}),{once:!0}):e()},dmx.Config=e=>{Object.assign(dmx.config,e)},dmx.Component=(e,t)=>{if(t){const r=t.extends?dmx.Component(t.extends):dmx.BaseComponent;"function"!=typeof t.initialData&&(t.initialData=Object.assign({},r.prototype.initialData,t.initialData)),t.attributes=Object.assign({},r.prototype.attributes,t.attributes),t.methods=Object.assign({},r.prototype.methods,t.methods),t.events=Object.assign({},r.prototype.events,t.events),t.hasOwnProperty("constructor")||(t.constructor=function(e,t){r.call(this,e,t)}),t.type=e;const n=dmx.createClass(t,r);n.extends=t.extends,dmx.__components[e]=n}return dmx.__components[e]},dmx.Attribute=(e,t,r)=>{dmx.__attributes[t][e]=r},dmx.Formatter=(e,t,r)=>{dmx.__formatters[e][t]=r},dmx.Formatters=(e,t)=>{for(const r in t)dmx.Formatter(e,r,t[r])},dmx.Adapter=(e,t,r)=>(r&&(dmx.__adapters[e][t]=r),dmx.__adapters[e][t]),dmx.Action=(e,t)=>{dmx.__actions[e]=t},dmx.Actions=e=>{for(const t in e)dmx.Action(t,e[t])},dmx.Startup=e=>{dmx.__startup.add(e)},dmx.debounce=(e,t)=>{let r;return function(){const n=()=>{e.apply(this,arguments)};t?(clearTimeout(r),r=setTimeout(n,t)):(cancelAnimationFrame(r),r=requestAnimationFrame(n))}},dmx.throttle=(e,t)=>{let r,n=!1;return function(){if(r=Array.from(arguments),!n){const s=()=>{n=!1,r&&e.apply(this,r)};e.apply(this,r),r=void 0,n=!0,t?setTimeout(db,t):requestAnimationFrame(s)}}},dmx.keyCodes={bs:8,tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40,delete:46,backspace:8,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,numlock:144,scrolllock:145,semicolon:186,equal:187,comma:188,minus:189,period:190,slash:191,backquote:192,bracketleft:219,backslash:220,bracketright:221,quote:222,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,numpadmultiply:106,numpadadd:107,numpadsubstract:109,numpaddivide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,digit0:48,digit1:49,digit2:50,digit3:51,digit4:52,digit5:53,digit6:54,digit7:55,digit8:56,digit9:57,keya:[65,97],keyb:[66,98],keyc:[67,99],keyd:[68,100],keye:[69,101],keyf:[70,102],keyg:[71,103],keyh:[72,104],keyi:[73,105],keyj:[74,106],keyk:[75,107],keyl:[76,108],keym:[77,109],keyn:[78,110],keyo:[79,111],keyp:[80,112],keyq:[81,113],keyr:[82,114],keys:[83,115],keyt:[84,116],keyu:[85,117],keyv:[86,118],keyw:[87,119],keyx:[88,120],keyy:[89,121],keyz:[90,122]},dmx.eventListener=function(e,t,r,n){let s,i;const a=function(e){if((!n.self||e.target===e.currentTarget)&&(!n.ctrl||e.ctrlKey)&&(!n.alt||e.altKey)&&(!n.shift||e.shiftKey)&&(!n.meta||e.metaKey)&&(!(e.originalEvent||e).nsp||Object.keys(n).includes((e.originalEvent||e).nsp))){if((e.originalEvent||e)instanceof MouseEvent){if(null!=n.button&&e.button!=(parseInt(n.button,10)||0))return;if(n.button0&&0!=e.button)return;if(n.button1&&1!=e.button)return;if(n.button2&&2!=e.button)return;if(n.button3&&3!=e.button)return;if(n.button4&&4!=e.button)return}if((e.originalEvent||e)instanceof KeyboardEvent){var t=[];Object.keys(n).forEach((function(e){var r=parseInt(e,10);r?t.push(r):dmx.keyCodes[e]&&t.push(dmx.keyCodes[e])}));for(var a=0;a<t.length;a++)if(Array.isArray(t[a])){if(!t[a].includes(e.which))return}else if(e.which!==t[a])return}if(n.stop&&e.stopPropagation(),n.prevent&&e.preventDefault(),e.originalEvent&&(e=e.originalEvent),e.$data||(e.$data={}),e instanceof MouseEvent&&(e.$data.altKey=e.altKey,e.$data.ctrlKey=e.ctrlKey,e.$data.metaKey=e.metaKey,e.$data.shiftKey=e.shiftKey,e.$data.pageX=e.pageX,e.$data.pageY=e.pageY,e.$data.x=e.x||e.clientX,e.$data.y=e.y||e.clientY,e.$data.button=e.button),e instanceof WheelEvent&&(e.$data.deltaX=e.deltaX,e.$data.deltaY=e.deltaY,e.$data.deltaZ=e.deltaZ,e.$data.deltaMode=e.deltaMode),window.PointerEvent&&e instanceof PointerEvent&&(e.$data.pointerId=e.pointerId,e.$data.width=e.width,e.$data.height=e.height,e.$data.pressure=e.pressure,e.$data.tangentialPressure=e.tangentialPressure,e.$data.tiltX=e.tiltX,e.$data.tiltY=e.tiltY,e.$data.twist=e.twist,e.$data.pointerType=e.pointerType,e.$data.isPrimary=e.isPrimary),window.TouchEvent&&e instanceof TouchEvent){const t=e=>({identifier:e.identifier,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY});e.$data.altKey=e.altKey,e.$data.ctrlKey=e.ctrlKey,e.$data.metaKey=e.metaKey,e.$data.shiftKey=e.shiftKey,e.$data.touches=Array.from(e.touches).map(t),e.$data.changedTouches=Array.from(e.changedTouches).map(t),e.$data.targetTouches=Array.from(e.targetTouches).map(t),e.$data.rotation=e.rotation,e.$data.scale=e.scale}if(e instanceof KeyboardEvent&&(e.$data.altKey=e.altKey,e.$data.ctrlKey=e.ctrlKey,e.$data.metaKey=e.metaKey,e.$data.shiftKey=e.shiftKey,e.$data.location=e.location,e.$data.repeat=e.repeat,e.$data.code=e.code,e.$data.key=e.key),n.debounce)clearTimeout(s),s=setTimeout((()=>{r.apply(this,arguments)}),parseInt(n.debounce,10)||0);else{if(!n.throttle)return r.apply(this,arguments);i||(i=!0,r.apply(this,arguments),setTimeout((()=>{i=!1}),parseInt(n.throttle,10)||0))}}};n=n||{},window.Dom7&&1===e.nodeType?Dom7(e)[n.once?"once":"on"](t.replace(/-/g,"."),a,!!n.capture):window.jQuery&&!n.capture?jQuery(e)[n.once?"one":"on"](t.replace(/-/g,"."),a):e.addEventListener(t.replace(/-/g,"."),a,{capture:!!n.capture,once:!!n.once,passive:!!n.passive})},dmx.fileUtils={fileReader:(e,t)=>new Promise(((r,n)=>{const s=new FileReader;s.onload=()=>r(s.result),s.onerror=()=>n(s.error),s[t](e)})),blobToArrayBuffer:function(e){return dmx.fileUtils.fileReader(e,"readAsArrayBuffer")},blobToBinaryString:function(e){return dmx.fileUtils.fileReader(e,"readAsBinaryString")},blobToDataURL:function(e){return dmx.fileUtils.fileReader(e,"readAsDataURL")},blobToBase64String:function(e){return dmx.fileUtils.fileReader(e,"readAsDataURL").then((e=>e.substring(e.indexOf(",")+1)))},arrayBufferToBlob:function(e,t){return Promise.resolve(new Blob([e],{type:t}))},binaryStringToBlob:function(e,t){const r=Uint8Array.from(e,(e=>e.charCodeAt(0)));return Promise.resolve(new Blob([r],{type:t}))},dataURLToBlob:function(e){const{data:t,type:r}=dmx.fileUtils.parseDataURL(e);return dmx.fileUtils.base64StringToBlob(t,r)},base64StringToBlob:function(e,t){const r=window.atob(e);return dmx.fileUtils.binaryStringToBlob(r,t)},parseDataURL:function(e){const t=e.match(/^data:(.*?)(;base64)?,(.*)$/);return{mediaType:t[1],base64:!!t[2],data:t[3],type:t[1].split(";")[0]}},parseMediaType:function(e){const t=e.match(/^([^/]+)\/([^+;]+)(?:\+([^;]+))?(?:;(.*))?$/);return{type:t[1],subtype:t[2],suffix:t[3],parameters:t[4]?t[4].split(";").reduce(((e,t)=>{const[r,n]=t.split("=");return e[r]=n,e}),{}):{}}}};{const e=function(e){const t=history[e];return function(){const r=t.apply(this,arguments),n=new Event(e.toLowerCase());return n.arguments=arguments,window.dispatchEvent(n),r}};history.pushState=e("pushState"),history.replaceState=e("replaceState")}window.onpopstate=function(e){e.state&&e.state.title&&(document.title=e.state.title)},document.documentElement.style.visibility="hidden",dmx.ready((()=>{Promise.all(dmx.__startup).then((()=>{if(dmx.app)throw Error("App already running!");history.replaceState({title:document.title},"");const e=document.querySelector(':root[dmx-app], [dmx-app], :root[is="dmx-app"], [is="dmx-app"]');if(!e)throw Error("App root not found!");const t=dmx.Component("app");dmx.app=new t(e,dmx.global),document.documentElement.style.visibility=""})).catch((e=>{console.error(e),document.documentElement.style.visibility=""}))})),dmx.extend=function(){var e={},t=!1,r=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],r++);for(var s=function(r){for(var n in r)"__proto__"!=n&&Object.prototype.hasOwnProperty.call(r,n)&&(t&&"[object Object]"===Object.prototype.toString.call(r[n])?e[n]=dmx.extend(!0,e[n],r[n]):null!=r[n]&&(e[n]=r[n]))};r<n;r++){s(arguments[r])}return e},dmx.parseDate=function(e){if("string"==typeof e){var t,r=0,n=[1,4,5,6,7,10,11];if("now"==e.toLowerCase())return new Date;if(t=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(e)){for(var s,i=0;s=n[i];++i)t[s]=+t[s]||0;return t[2]=(+t[2]||1)-1,t[3]=+t[3]||1,void 0===t[8]?new Date(t[1],t[2],t[3],t[4],t[5],t[6],t[7]):("Z"!==t[8]&&void 0!==t[9]&&(r=60*t[10]+t[11],"+"===t[9]&&(r=0-r)),new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5]+r,t[6],t[7])))}if(t=/^(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?$/.exec(e)){var a=new Date;return"Z"===t[5]?(a.setUTCHours(+t[1]||0),a.setUTCMinutes(+t[2]||0),a.setUTCSeconds(+t[3]||0),a.setUTCMilliseconds(+t[4]||0)):(a.setHours(+t[1]||0),a.setMinutes(+t[2]||0),a.setSeconds(+t[3]||0),a.setMilliseconds(+t[4]||0)),a}return new Date(e)}return"number"==typeof e?new Date(1e3*e):new Date("")},dmx.hashCode=function(e){if(null==e)return 0;var t,r=JSON.stringify(e),n=0;for(t=0;t<r.length;t++)n=(n<<5)-n+r.charCodeAt(t),n&=n;return Math.abs(n)},dmx.randomizer=function(e){return e=+e||0,function(){return(e=(9301*e+49297)%233280)/233280}},dmx.repeatItems=function(e){const t=[];if(e)if("object"==typeof e)if(Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const n=dmx.clone(e[r]);t.push(Object.assign({},n,{$key:r,$index:r,$value:n}))}else{let r=0;for(const n in e)if(e.hasOwnProperty(n)){const s=dmx.clone(e[n]);t.push(Object.assign({},s,{$key:n,$index:r,$value:s})),r++}}else if("number"==typeof e)for(let r=0;r<e;r++)t.push({$key:String(r),$index:r,$value:r+1});return t},dmx.escapeRegExp=function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},dmx.validate=function(e){return"FORM"==e.tagName&&Array.from(e.elements).forEach((e=>e.dirty=!0)),e.checkValidity()},dmx.validateReset=function(e){},(()=>{const e=[];window.addEventListener("message",(t=>{if(t.source===window&&"dmxNextTick"===t.data&&e.length){const t=e.shift();t.fn.call(t.context)}})),dmx.nextTick=(t,r)=>{e.push({fn:t,context:r}),window.postMessage("dmxNextTick","*")}})(),dmx.requestUpdate=function(){var e=!1,t=new Set;return function(r){t.add(r||"*"),e||(e=!0,dmx.requestUpdate.requested=!0,dmx.nextTick((function(){if(e=!1,dmx.requestUpdate.requested=!1,dmx.app){var r=new Set(t);t.clear(),dmx.app.$update(r)}})))}}(),"app:"==document.location.protocol&&dmx.Startup(new Promise((e=>document.addEventListener("deviceready",e)))),(()=>{
/*! (c) Andrea Giammarchi */
const{is:e}=Object;let t;dmx.batch=e=>{const r=t;t=r||[];try{if(e(),!r)for(const{value:e}of t);}finally{t=r}};class r{constructor(e){this._=e}toJSON(){return this.value}toString(){return String(this.value)}valueOf(){return this.value}}let n;dmx.Signal=r;class s extends r{s;constructor(e,t,r,n){super(e),this.f=n,this.$=!0,this.r=new Set,this.s=new p(t,r)}peek(){return this.s.peek()}get value(){if(this.$){const e=n;n=this;try{this.s.value=this._(this.s._)}finally{this.$=!1,n=e}}return this.s.value}}const i={async:!1,equals:!0};let a;dmx.computed=(e,t,r=i)=>new s(e,t,r,!1);const o=[],d=()=>{},h=({s:e})=>{"function"==typeof e._&&(e._=e._())};class l extends s{constructor(e,t,r){super(e,t,r,!0),this.e=o}run(){return this.$=!0,this.value,this}stop(){this._=d,this.r.clear(),this.s.c.clear()}}dmx.FX=l;class u extends l{constructor(e,t,r){super(e,t,r),this.i=0,this.a=!!r.async,this.m=!0,this.e=[]}get value(){this.a?this.async():this.sync()}async(){this.m&&(this.m=!1,queueMicrotask((()=>{this.m=!0,this.sync()})))}sync(){const e=a;(a=this).i=0,h(this),super.value,a=e}stop(){super.stop(),h(this);for(const e of this.e.splice(0))e.stop()}}dmx.Effect=u;dmx.effect=(e,t,r=i)=>{let n;if(a){const{i:s,e:i}=a,o=s===i.length;(o||i[s]._!==e)&&(o||i[s].stop(),i[s]=new u(e,t,r).run()),n=i[s],a.i++}else n=new u(e,t,r).run();return()=>{n.stop()}};const c=()=>!1;class p extends r{constructor(t,{equals:r}){super(t),this.c=new Set,this.s=!0===r?e:r||c}peek(){return this._}get value(){return n&&(this.c.add(n),n.r.add(this)),this._}set value(e){const r=this._;if(!this.s(this._=e,r)&&this.c.size){const e=[],r=[this];for(const t of r)for(const n of t.c)if(!n.$&&n.r.has(t))if(n.r.clear(),n.$=!0,n.f){e.push(n);const t=[n];for(const e of t)for(const r of e.e)r.r.clear(),r.$=!0,t.push(r)}else r.push(n.s);for(const r of e)t?t.push(r):r.value}}}dmx.signal=(e,t=i)=>new p(e,t)})(),dmx.signalProxy=function(e={}){const t=Object.create(null),r=(e,t)=>e===t&&(!(e instanceof dmx.BaseComponent)&&dmx.equal(e,t));return new Proxy(e,{get(e,n,s){const i=Reflect.get(e,n,s);return"string"==typeof n&&n.startsWith("_")?i:(t[n]||(t[n]=dmx.signal(i,{equals:r})),t[n].value)},set(e,n,s,i){const a=Reflect.set(e,n,s,i);return"string"==typeof n&&n.startsWith("_")||a&&(t[n]?t[n].value=s:t[n]=dmx.signal(s,{equals:r})),a},deleteProperty(e,r){const n=Reflect.deleteProperty(e,r);return n&&t[r]&&(t[r].value=void 0),n}})},(()=>{class e{constructor(e={},t=null){"object"!=typeof e&&(e={$value:e}),this.data=dmx.signalProxy(),Object.assign(this.data,e),this.parent=t,this.seed=Math.random()}get(e){this.data[e];return this.data.hasOwnProperty(e)?this.data[e]:this.parent?"parent"==e?this.parent.data:this.parent.get(e):null}set(e,t){if("object"==typeof e)for(const t in e)e.hasOwnProperty(t)&&this.set(t,e[t]);else this.data[e]=t}has(e){return this.data.hasOwnProperty(e)}del(e){delete this.data[e]}}dmx.global=new e,dmx.DataScope=function(t,r){return new e(t,r||dmx.global)}})(),function(){var e=function(t){if(!(this instanceof e))return new e(t);if(t instanceof e)return t;if(!t)return this;var r=t.length;if(t.nodeType)this[0]=t,this.length=1;else{if("string"==typeof t)return e(document.querySelectorAll(t));if(r)for(var n=0;n<r;n++)t[n]&&t[n].nodeType&&(this[this.length]=t[n],this.length++)}return this};e.prototype={constructor:e,length:0,addClass:function(e){for(var t=0;t<this.length;t++)this[t].classList.add(e);return this},removeClass:function(e){for(var t=0;t<this.length;t++)this[t].classList.remove(e);return this},toggleClass:function(e){for(var t=0;t<this.length;t++)this[t].classList.toggle(e);return this},hasClass:function(e){return!!this[0]&&this[0].classList.contains(e)},attr:function(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]&&this[0].getAttribute(e);for(var r=0;r<this.length;r++)if(2===arguments.length)this[r].setAttribute(e,t);else for(var n in e)e.hasOwnProperty(n)&&this[r].setAttribute(n,e[n]);return this},removeAttr:function(e){for(var t=0;t<this.length;t++)this[t].removeAttribute(e);return this},prop:function(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]&&this[0][e];for(var r=0;r<this.length;r++)if(2===arguments.length)this[r][e]=t;else for(var n in e)e.hasOwnProperty(n)&&(this[r][n]=e[n]);return this},css:function(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]&&window.getComputedStyle(this[0],null).getPropertyValue(e);for(var r=0;r<this.length;r++)if(2===arguments.length)this[r].style.setProperty(e,t);else for(var n in e)e.hasOwnProperty(n)&&this[r].style.setProperty(n,e[n]);return this},each:function(e,t){if(!e)return this;for(var r=0;r<this.length;r++)if(!1===e.call(t||this[r],r,this[r]))return this;return this},append:function(){for(var t=0;t<arguments.length;t++)for(var r=e(arguments[t]),n=0;n<r.length;n++)this[0].appendChild(r[n]);return this},appendTo:function(t){return e(t).append(this),this},detach:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},empty:function(){for(var e=0;e<this.length;e++)this[e].innerHTML="";return this}},dmx.dom={get:function(t){return e(document.getElementById(t))},select:function(t){return e(t)},create:function(t){var r=document.createElement(t);return e(r)},contains:function(e){return document.documentElement.contains(e)},walk:function(e,t,r){if(e){if(!1===t.call(r,e))return;if(e.hasChildNodes())for(const n of Array.from(e.childNodes))dmx.dom.walk(n,t,r)}},getAttributes:function(e){var t=[];if(1==e.nodeType)for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r];if(n&&n.specified&&dmx.rePrefixed.test(n.name)){var s=n.name.substr(4),i=null,a={};s.split(".").forEach((function(e,t){if(0===t)s=e;else{var r=e.indexOf(":");r>0?a[e.substr(0,r)]=e.substr(r+1):a[e]=!0}}));var o=s.indexOf(":");o>0&&(i=s.substr(o+1),s=s.substr(0,o)),t.push({name:s,fullName:n.name,value:n.value,argument:i,modifiers:a})}}return t},remove:function(e){Array.isArray(e)?e.forEach((function(e){dmx.dom.remove(e)})):e.remove()},replace:function(e,t){e.parentNode&&e.parentNode.replaceChild(t,e)}}}(),function(){var e={},t={Boolean:"boolean",Null:"null",Undefinec:"undefined",Number:"number",BigInt:"number",String:"string",Date:"date",RegExp:"regexp",Blob:"blob",File:"file",FileList:"filelist",ArrayBuffer:"arraybuffer",ImageBitmap:"imagebitmap",ImageData:"imagedata",Array:"array",Object:"object",Map:"map",Set:"set",DataView:"array",Int8Array:"array",Uint8Array:"array",Uint8ClampedArray:"array",Int16Array:"array",Uint16Array:"array",Int32Array:"array",Uint32Array:"array",Float32Array:"array",Float64Array:"array",BigInt64Array:"array",BigUint64Array:"array"},r={"{":"L_CURLY","}":"R_CURLY","(":"L_PAREN",")":"R_PAREN","[":"L_BRACKET","]":"R_BRACKET",".":"PERIOD",",":"COMMA",";":"SEMI",":":"COLON","?":"QUESTION","+":"ADDICTIVE","-":"ADDICTIVE","*":"MULTIPLICATIVE","/":"MULTIPLICATIVE","%":"MULTIPLICATIVE","===":"EQUALITY","!==":"EQUALITY","==":"EQUALITY","!=":"EQUALITY","<":"RELATIONAL",">":"RELATIONAL","<=":"RELATIONAL",">=":"RELATIONAL",in:"RELATIONAL","&&":"LOGICAL_AND","||":"LOGICAL_OR","!":"LOGICAL_NOT","&":"BITWISE_AND","|":"BITWISE_OR","^":"BITWISE_XOR","~":"BITWISE_NOT","<<":"BITWISE_SHIFT",">>":"BITWISE_SHIFT",">>>":"BITWISE_SHIFT"},n={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"',"`":"`"},s={"**":function(e,t){return Math.pow(e(),t())},"??":function(e,t){return null==(e=e())?t():e},in:function(e,t){return e()in t()},"?":function(e,t,r){return e()?t():r()},"+":function(e,t){return e=e(),t=t(),null==e?t:null==t?e:e+t},"-":function(e,t){return e()-t()},"*":function(e,t){return e()*t()},"/":function(e,t){return e()/t()},"%":function(e,t){return e()%t()},"===":function(e,t){return e()===t()},"!==":function(e,t){return e()!==t()},"==":function(e,t){return e()==t()},"!=":function(e,t){return e()!=t()},"<":function(e,t){return e()<t()},">":function(e,t){return e()>t()},"<=":function(e,t){return e()<=t()},">=":function(e,t){return e()>=t()},"&&":function(e,t){return e()&&t()},"||":function(e,t){return e()||t()},"&":function(e,t){return e()&t()},"|":function(e,t){return e()|t()},"^":function(e,t){return e()^t()},"<<":function(e,t){return e()<<t()},">>":function(e,t){return e()>>t()},">>>":function(e,t){return e()>>>t()},"~":function(e){return~e()},"!":function(e){return!e()}},i={this:function(e){return function(){return e.data}},undefined:function(){return function(){}},null:function(){return function(){return null}},true:function(){return function(){return!0}},false:function(){return function(){return!1}},_:function(){return function(){return{__dmxScope__:!0}}}},a=function(){return 0};dmx.getType=function(e){return t[Object.prototype.toString.call(e).slice(8,-1)]},dmx.getIdents=function(e){if("string"!=typeof e)return[];let t=[];if(e.includes("{{")){let r;for(;null!=(r=dmx.reExpressionReplace.exec(e));)t=t.concat(dmx.lexer(r[1]))}else t=dmx.lexer(e);return t.reduce(((e,t)=>("IDENT"==t.name?e.push(t.value):"STRING"==t.name&&t.value.startsWith("{{")&&(e=e.concat(dmx.getIdents(t.value))),e)),[])},dmx.lexer=function(t){if(e[t])return e[t];for(var s,i,a,o,d,h,l=[],u=0,c=!0;u<t.length;){if(a=u,v(o=p())&&c)i="STRING",s=w(o),c=!1;else if((y(o)||m(".")&&f()&&y(f()))&&c)i="NUMBER",s=E(),c=!1;else if(g(o)&&c)i="IDENT",s=$(),m("(")&&(i="METHOD"),c=!1;else if(m("/")&&c&&("("==s||","==s||"?"==s||":"==s)&&A())i="REGEXP",s=k(),c=!1;else{if(x(o)){u++;continue}if((h=p(3))&&r[h])i=r[h],s=h,c=!0,u+=3;else if((d=p(2))&&r[d])i=r[d],s=d,c=!0,u+=2;else{if(!r[o])throw Error("Lexer Error: Unexpected token '"+o+"' at column "+u+" in expression ["+t+"]");i=r[o],s=o,c=!0,u++}}l.push({name:i,index:a,value:s})}return e[t]=l,l;function p(e){return e>1?t.substr(u,e):t[u]}function f(e){return u+(e=e||1)<t.length&&t[u+e]}function m(e){return-1!=e.indexOf(o)}function v(e){return'"'==e||"'"==e||"`"==e}function y(e){return e>="0"&&e<="9"}function g(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"==e||"$"==e}function _(e){return g(e)||y(e)}function x(e){return" "==e||"\r"==e||"\t"==e||"\n"==e||"\v"==e||"Â "==e}function b(e){return"-"==e||"+"==e||y(e)}function w(e){var r="",s=!1;for(u++;u<t.length;){if(o=p(),s){if("u"==o){u++;var i=p(4);if(i.match(/[\da-f]{4}/i))throw Error("Invalid unicode escape at column "+u+" in expression ["+t+"]");r+=String.fromCharCode(parseInt(i,16)),u+=3}else{var a=n[o];r+=a||o}s=!1}else if("\\"==o)s=!0;else{if(o==e)return u++,"`"==e&&(r="{{"+r+"}}"),r;r+=o}u++}throw Error("Unterminated quote in expression ["+t+"]")}function E(){for(var e="",r=!1;u<t.length;){if(o=p(),m(".")&&f()&&y(f())||y(o))e+=o;else{var n=f();if(m("eE")&&b(n))e+="e",r=!0;else{if(!(b(o)&&n&&y(n)&&r)){if(!b(o)||n&&y(n)||!r)break;throw Error('Invalid exponent "'+o+'" in expression ['+t+"]")}e+=o,r=!1}}u++}return+e}function $(){for(var e="";u<t.length&&_(o=p());)e+=o,u++;return e}function k(){var e="",r="",n=!1;for(u++;u<t.length;){if(o=p(),n)n=!1;else if("\\"==o)n=!0;else if("/"==o){for(u++;-1!="ign".indexOf(o=p());)r+=o,u++;return new RegExp(e,r)}e+=o,u++}throw Error("Unterminated regexp in expression ["+t+"]")}function A(){var e=u,t=!0;try{k()}catch(e){t=!1}return u=e,o="/",t}},dmx.parse=function(e,t){if(t=t||dmx.app,dmx.reExpression.test(e))return"{{"==e.substr(0,2)&&"}}"==e.substr(-2)&&-1==e.indexOf("{{",2)?dmx.parse(e.substring(2,e.length-2),t):e.replace(dmx.reExpressionReplace,(function(e,r){var n=dmx.parse(r,t);return null==n?"":n}));if(e.trim()){var r;try{var n,o=dmx.lexer(e).slice(0);r=function(){var e=[];for(;;)if(o.length>0&&!(h("R_PAREN")||h("R_BRACKET")||h("R_CURLY")||h("COMMA")||h("SEMI"))&&e.push(p()),!l("COMMA")&&!l("SEMI"))return(1==e.length?e[0]:t)();function t(){for(var t,r=0;r<e.length;r++){var n=e[r];n&&(t=n())}return t}}()}catch(e){console.error(e)}return r}function d(){if(0===o.length)throw Error("Unexpected end in expression ["+e+"]");return o[0]}function h(e){if(o.length>0){var t=o[0];if(!e||t.name==e)return t}return!1}function l(e){var t=h(e);return!!t&&(o.shift(),t)}function u(t){if(!l(t))throw Error("Unexpected token, expecting ["+t+"] in expression ["+e+"]")}function c(e){var r=Array.prototype.slice.call(arguments,1);return function(){return s.hasOwnProperty(e)?s[e].apply(t,r):e}}function p(){return f()}function f(){var t,r=function(){var e,t=m();for(;;){if(!(e=l("LOGICAL_OR")))return t;t=c(e.value,t,m())}}();if(l("QUESTION")){if(t=f(),l("COLON"))return c("?",r,t,f());throw Error('Expecting a ":" in expression ['+e+"]")}return r}function m(){var e,t=function(){var e,t=v();(e=l("BITWISE_OR"))&&(t=c(e.value,t,v()));return t}();return(e=l("LOGICAL_AND"))&&(t=c(e.value,t,m())),t}function v(){var e,t=y();return(e=l("BITWISE_XOR"))&&(t=c(e.value,t,y())),t}function y(){var e,t=g();return(e=l("BITWISE_AND"))&&(t=c(e.value,t,y())),t}function g(){var e,t=_();return(e=l("EQUALITY"))&&(t=c(e.value,t,g())),t}function _(){var e,t=function(){var e,t=x();for(;e=l("BITWISE_SHIFT");)t=c(e.value,t,x());return t}();return(e=l("RELATIONAL"))&&(t=c(e.value,t,_())),t}function x(){for(var e,t=b();e=l("ADDICTIVE");)t=c(e.value,t,b());return t}function b(){for(var e,t=w();e=l("MULTIPLICATIVE");)t=c(e.value,t,w());return t}function w(){var e;return(e=l("ADDICTIVE"))?"+"==e.value?E():c(e.value,a,w()):(e=l("LOGICAL_NOT"))?c(e.value,w()):E()}function E(){var r,s;if(l("L_PAREN"))r=p(),u("R_PAREN");else if(l("L_CURLY")){var a={};if("R_CURLY"!=d().name)do{var o=l().value;u("COLON"),a[o]=p()()}while(l("COMMA"));r=c(a),u("R_CURLY")}else if(l("L_BRACKET")){var f=[];if("R_BRACKET"!=d().name)do{f.push(p()())}while(l("COMMA"));r=c(f),u("R_BRACKET")}else if(l("PERIOD"))r=h()?A(c(t.data)):c(t.data);else{var m=l();if(!1===m)throw Error("Not a primary expression ["+e+"]");r="IDENT"==m.name?i.hasOwnProperty(m.value)?i[m.value](t):function(){return t.get(m.value)}:"METHOD"==m.name?c(dmx.__formatters.global[m.value]||function(){window.warn&&console.warn("Formatter "+m.value+" in expression ["+e+"] doesn't exist")}):function(){return m.value}}for(;s=l("L_PAREN")||l("L_BRACKET")||l("PERIOD");)if("("==s.value)r=$(r,n);else if("["==s.value)n=r,r=k(r);else{if("."!=s.value)throw Error("Parse Error in expression ["+e+"]");n=r,r=A(r)}return n=null,r}function $(e,r){var n=[];if("R_PAREN"!=d().name)do{n.push(p())}while(l("COMMA"));return u("R_PAREN"),function(){var s=[];r&&s.push(r());for(var i=0;i<n.length;i++)s.push(n[i]());return(e()||dmx.noop).apply(t,s)}}function k(e){var r=p();return u("R_BRACKET"),function(){var n=e(),s=r();if("object"==typeof n&&null!=n)return n.__dmxScope__?t.get(s):"map"==dmx.getType(n)?n.get(s):n[s]}}function A(r){var n=l();return function(){var s=r(),i=dmx.getType(s);return"METHOD"==n.name?"map"==i&&"function"==typeof s.get("__"+n.value)?(console.log("function",n.value,s.get("__"+n.value)),s.get("__"+n.value)):"object"==i&&"function"==typeof s["__"+n.value]?s["__"+n.value]:dmx.__formatters[i]&&dmx.__formatters[i][n.value]?dmx.__formatters[i][n.value]:dmx.__formatters.any&&dmx.__formatters.any[n.value]?dmx.__formatters.any[n.value]:function(){null!=s&&console.warn&&console.warn("Formatter "+n.value+" in expression ["+e+"] doesn't exist for type "+i)}:s&&s.__dmxScope__?t.get(n.value):"map"==i?s.get(n.value):s&&s.hasOwnProperty(n.value)?s[n.value]:void 0}}}}(),dmx.BaseComponent=dmx.createClass({constructor:function(e,t){this.$node=e,this.parent=t,this.bindings={},this.propBindings={},this.children=[],this.listeners={},this._prevProps={},this._updatedProps=new Set,this.updatedProps=new Map,this.updateRequested=!1,this.isInitialized=!1,this.isDestroyed=!1,this.props=new Proxy({},{set:(e,t,r,n)=>{const s=Reflect.get(e,t,n),i=Reflect.set(e,t,r,n);return i&&this.isInitialized&&!dmx.equal(s,r)&&(this._updatedProps.add(t),this.requestUpdate(t,s),dmx.requestUpdate(t)),i}}),this.data=dmx.signalProxy(),this.seed=Math.random(),this.name=e.getAttribute("id")||e.getAttribute("name")||this.type&&this.type.toLowerCase().replace(/^dmx-/,"")||"",this.name=this.name.replace(/[^\w]/g,"");try{this.$initialData(),this.$parseAttributes(e),this.init(e),!1!==this.render&&this.render(e),this.$node&&(this.$customAttributes("mounted",this.$node),this.$node.dmxComponent=this,this.$node.dmxRendered=!0),this.isInitialized=!0}catch(e){console.error(e)}},tag:null,initialData:{},attributes:{},methods:{},events:{destroy:Event},render:function(e){this.$node&&this.$parse()},parse:function(e){return dmx.parse(e,this)},find:function(e){if(this.name==e)return this;for(var t=0;t<this.children.length;t++){var r=this.children[t].find(e);if(r)return r}return null},init:dmx.noop,beforeUpdate:dmx.noop,update:dmx.noop,updated:dmx.noop,beforeDestroy:dmx.noop,destroy:dmx.noop,destroyed:dmx.noop,addEventListener:function(e,t){e in this.listeners||(this.listeners[e]=new Set),this.listeners[e].add(t)},removeEventListener:function(e,t){e in this.listeners&&this.listeners[e].delete(t)},dispatchEvent:function(e,t,r,n){if(!this.isDestroyed){if("string"==typeof e)e=new(this.events[e]||CustomEvent)(e,t);if(!(e.type in this.listeners))return!0;e.nsp=n,e.target=this,e.$data=r||{};for(let t of this.listeners[e.type])!1===t.call(this,e)&&e.preventDefault();return!e.defaultPrevented}},$createChild:function(e,t){var r=new(0,dmx.__components[e])(t,this);this.$addChild(r,r.name)},$addChild:function(e,t){this.children.push(e),t&&(this.data[t]&&dmx.debug&&console.warn('Duplicate name "'+t+'" found, component not added to scope.'),this.set(t,e.data))},$removeChild:function(e){this.children.includes(e)&&this.children.splice(this.children.indexOf(e),1),e.name&&this.data[e.name]&&this.del(e.name)},$customAttributes:function(e,t,r){r||(r=dmx.dom.getAttributes(t)),r.forEach((r=>{var n;"bind"==r.name&&this.attributes[(n=r.argument,n.replace(/-./g,(e=>e[1].toUpperCase())))]||("on"==r.name&&this.events[r.argument]||dmx.__attributes[e][r.name]&&dmx.__attributes[e][r.name].call(this,t,r))}))},$parseTextNode(e){if(3===e.nodeType&&dmx.reExpression.test(e.nodeValue)){const t=e.nodeValue.replace(dmx.reExpressionReplace,((e,t)=>`##split##${t}##split##`)).split("##split##"),r=document.createDocumentFragment();t.forEach(((e,t)=>{const n=document.createTextNode(e);r.appendChild(n),t%2&&this.$watch(e,(e=>{n.nodeValue=e}))})),e.parentNode.replaceChild(r,e)}},$parse:function(e){if(e=e||this.$node)return 3===e.nodeType?this.$parseTextNode(e):void(1===e.nodeType&&(dmx.config.mapping&&Object.keys(dmx.config.mapping).forEach((t=>{dmx.array(e.querySelectorAll(t)).forEach((e=>{e.hasAttribute("is")||e.setAttribute("is","dmx-"+dmx.config.mapping[t])}))})),dmx.dom.walk(e,(function(e){if(e!=this.$node){if(1===e.nodeType){var t=e.tagName.toLowerCase(),r=dmx.dom.getAttributes(e);if(e.hasAttribute("is")&&(t=e.getAttribute("is")),dmx.reIgnoreElement.test(t))return!1;if(this.$customAttributes("before",e,r),-1!==r.findIndex((e=>"repeat"===e.name)))return!1;if(dmx.rePrefixed.test(t))return(t=t.replace(/^dmx-/i,""))in dmx.__components?(e.isComponent=!0,e.dmxRendered?window.__WAPPLER__&&e.dmxComponent&&e.dmxComponent.$parse&&(dmx.reIgnoreElement.test(e.tagName)||e.dmxComponent.$parse()):this.$createChild(t,e),!1):void console.warn("Unknown component found! "+t);this.$customAttributes("mounted",e,r)}3===e.nodeType&&this.$parseTextNode(e)}}),this)))},$update:function(e){!1!==this.beforeUpdate(e)&&(this.update(this._prevProps,this._updatedProps),this.children.forEach((t=>{t.$update(e)})),this.updated(),this._prevProps=dmx.clone(this.props),this._updatedProps.clear())},$parseAttributes:function(e){for(const t in this.attributes){const r=this.attributes[t],n=t.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()));let s=r.default;if(e.hasAttribute(n)){if(r.type===Boolean)s="false"!==e.getAttribute(n);else{if(s=e.getAttribute(n),r.type===Number&&s&&isFinite(Number(s))&&(s=Number(s)),r.type===Object||r.type===Array)try{s=JSON.parse(s)}catch(e){console.warn("Invalid attribute value, expected a JSON string got "+s)}r.enum&&!r.enum.includes(s)&&(s=r.default),r.validate&&!r.validate(s)&&(s=r.default)}this.props[t]=s}if(e.hasAttribute("dmx-bind:"+n)){const s=e.getAttribute("dmx-bind:"+n);this.$watch(s,(e=>{void 0===e?e=r.default:r.type===Boolean?e=!!e:(null!=e&&(r.type===Number&&("string"==typeof e?e=e&&isFinite(Number(e))?Number(e):r.default:"number"==typeof e&&isFinite(Number(e))||(e=r.default)),r.type===String&&(e=String(e)),r.type===Object&&"object"!=typeof e&&(e=r.default),r.type===Array&&(e=Array.from(e))),r.enum&&!r.enum.includes(e)&&(e=r.default),r.validate&&!r.validate(e)&&(e=r.default)),this.props[t]=e,this.props[n]=e}))}else this.props[t]=s,this.props[n]=s}for(const t in this.events)e.hasAttribute("on"+t)&&dmx.eventListener(this,t,Function("event",e.getAttribute("on"+t)),{});dmx.dom.getAttributes(e).forEach((e=>{"on"==e.name&&this.events[e.argument]&&dmx.eventListener(this,e.argument,(t=>(t.originalEvent&&(t=t.originalEvent),dmx.parse(e.value,dmx.DataScope({$event:t.$data,$originalEvent:t},this)))),e.modifiers)}))},requestUpdate:function(e,t){this.performUpdate&&(this.updatedProps.has(e)||this.updatedProps.set(e,t),this.updateRequested||dmx.nextTick((()=>{this.isDestroyed||(this.updateRequested=!1,this.performUpdate(this.updatedProps),this.updatedProps.clear())})),this.updateRequested=!0)},$initialData:function(){Object.assign(this.data,{$type:this.type},"function"==typeof this.initialData?this.initialData():this.initialData),Object.keys(this.methods).forEach((function(e){var t=this;this.data["__"+e]=function(){return t.methods[e].apply(t,Array.prototype.slice.call(arguments,1))}}),this)},$addBinding:function(e,t){this.$watch(e,t)},$watch:function(e,t){this.effects||(this.effects=[]);let r=!0;this.effects.push(dmx.effect((()=>{if(r)t.call(this,this.parse(e)),r=!1;else{const r=this.parse(e);queueMicrotask((()=>t.call(this,r)))}})))},$destroy:function(){this.dispatchEvent("destroy"),this.beforeDestroy(),this.destroy(),this.isDestroyed=!0,this.parent&&this.parent.$removeChild(this),this.$node&&dmx.dom.remove(this.$node),this.effects&&(this.effects.forEach((e=>{e()})),this.effects=null),this.$destroyChildren(),this.$node=null,this.parent=null,this.data={},this.destroyed()},$destroyChildren:function(){this.children.forEach((e=>{e.$destroy()})),this.children=[]},get:function(e,t){return void 0!==this.data[e]?this.data[e]:this.parent&&!0!==t?"parent"==e?this.parent.data:this.parent.get(e):null},add:function(e,t){this.data[e]?Array.isArray(this.data[e])?this.data[e].push(t):this.data[e]=[this.data[e],t]:this.set(e,t)},set:function(e,t){"object"!=typeof e?this.data[e]!==t&&(this.data[e]=t):dmx.batch((()=>{for(var t in e)e.hasOwnProperty(t)&&this.set(t,e[t])}))},del:function(e){delete this.data[e]}}),function(){dmx.pathToRegexp=d,dmx.pathToRegexp.parse=r,dmx.pathToRegexp.compile=function(e,t){return n(r(e,t))},dmx.pathToRegexp.tokensToFunction=n,dmx.pathToRegexp.tokensToRegExp=o;var e="/",t=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function r(r,n){for(var a,o=[],d=0,h=0,l="",u=n&&n.delimiter||e,c=n&&n.whitelist||void 0,p=!1;null!==(a=t.exec(r));){var f=a[0],m=a[1],v=a.index;if(l+=r.slice(h,v),h=v+f.length,m)l+=m[1],p=!0;else{var y="",g=a[2],_=a[3],x=a[4],b=a[5];if(!p&&l.length){var w=l.length-1,E=l[w];(!c||c.indexOf(E)>-1)&&(y=E,l=l.slice(0,w))}l&&(o.push(l),l="",p=!1);var $="+"===b||"*"===b,k="?"===b||"*"===b,A=_||x,C=y||u;o.push({name:g||d++,prefix:y,delimiter:C,optional:k,repeat:$,pattern:A?i(A):"[^"+s(C===u?C:C+u)+"]+?"})}}return(l||h<r.length)&&o.push(l+r.substr(h)),o}function n(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var s="",i=n&&n.encode||encodeURIComponent,a=0;a<e.length;a++){var o=e[a];if("string"!=typeof o){var d,h=r?r[o.name]:void 0;if(Array.isArray(h)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but got array');if(0===h.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<h.length;l++){if(d=i(h[l],o),!t[a].test(d))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'"');s+=(0===l?o.prefix:o.delimiter)+d}}else if("string"!=typeof h&&"number"!=typeof h&&"boolean"!=typeof h){if(!o.optional)throw new TypeError('Expected "'+o.name+'" to be '+(o.repeat?"an array":"a string"))}else{if(d=i(String(h),o),!t[a].test(d))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+d+'"');s+=o.prefix+d}}else s+=o}return s}}function s(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function i(e){return e.replace(/([=!:$/()])/g,"\\$1")}function a(e){return e&&e.sensitive?"":"i"}function o(t,r,n){for(var i=(n=n||{}).strict,o=!1!==n.start,d=!1!==n.end,h=n.delimiter||e,l=[].concat(n.endsWith||[]).map(s).concat("$").join("|"),u=o?"^":"",c=0;c<t.length;c++){var p=t[c];if("string"==typeof p)u+=s(p);else{var f=p.repeat?"(?:"+p.pattern+")(?:"+s(p.delimiter)+"(?:"+p.pattern+"))*":p.pattern;r&&r.push(p),p.optional?p.prefix?u+="(?:"+s(p.prefix)+"("+f+"))?":u+="("+f+")?":u+=s(p.prefix)+"("+f+")"}}if(d)i||(u+="(?:"+s(h)+")?"),u+="$"===l?"$":"(?="+l+")";else{var m=t[t.length-1],v="string"==typeof m?m[m.length-1]===h:void 0===m;i||(u+="(?:"+s(h)+"(?="+l+"))?"),v||(u+="(?="+s(h)+"|"+l+")")}return new RegExp(u,a(n))}function d(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,t):Array.isArray(e)?function(e,t,r){for(var n=[],s=0;s<e.length;s++)n.push(d(e[s],t,r).source);return new RegExp("(?:"+n.join("|")+")",a(r))}(e,t,n):function(e,t,n){return o(r(e,n),t,n)}(e,t,n)}}(),window.Hjson||(window.Hjson={},Hjson.parse=function(e){var t,r,n,s={'"':'"',"'":"'","\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function i(e){return"{"===e||"}"===e||"["===e||"]"===e||","===e||":"===e}function a(e){var n,s=0,i=1;for(n=r-1;n>0&&"\n"!==t[n];n--,s++);for(;n>0;n--)"\n"===t[n]&&i++;throw new Error(e+" at line "+i+","+s+" >>>"+t.substr(r-s,20)+" ...")}function o(){return n=t.charAt(r),r++,n}function d(e){return t.charAt(r+e)}function h(e){for(var t="",r=n;o();){if(n===r)return o(),e&&"'"===r&&"'"===n&&0===t.length?(o(),l()):t;if("\\"===n)if(o(),"u"===n){for(var i=0,d=0;d<4;d++){o();var h,u=n.charCodeAt(0);n>="0"&&n<="9"?h=u-48:n>="a"&&n<="f"?h=u-97+10:n>="A"&&n<="F"?h=u-65+10:a("Bad \\u char "+n),i=16*i+h}t+=String.fromCharCode(i)}else{if("string"!=typeof s[n])break;t+=s[n]}else"\n"===n||"\r"===n?a("Bad string containing newline"):t+=n}a("Bad string")}function l(){for(var e="",t=0,r=0;;){var s=d(-r-5);if(!s||"\n"===s)break;r++}function i(){for(var e=r;n&&n<=" "&&"\n"!==n&&e-- >0;)o()}for(;n&&n<=" "&&"\n"!==n;)o();for("\n"===n&&(o(),i());;){if(n){if("'"===n){if(t++,o(),3===t)return"\n"===e.slice(-1)&&(e=e.slice(0,-1)),e;continue}for(;t>0;)e+="'",t--}else a("Bad multiline string");"\n"===n?(e+="\n",o(),i()):("\r"!==n&&(e+=n),o())}}function u(){if('"'===n||"'"===n)return h(!1);for(var e="",t=r,s=-1;;){if(":"===n)return e?s>=0&&s!==e.length&&(r=t+s,a("Found whitespace in your key name (use quotes to include)")):a("Found ':' but no key name (for an empty key name use quotes)"),e;n<=" "?n?s<0&&(s=e.length):a("Found EOF while looking for a key name (check your syntax)"):i(n)?a("Found '"+n+"' where a key name was expected (check your syntax or use quotes if the key name includes {}[],: or whitespace)"):e+=n,o()}}function c(){for(;n;){for(;n&&n<=" ";)o();if("#"===n||"/"===n&&"/"===d(0))for(;n&&"\n"!==n;)o();else{if("/"!==n||"*"!==d(0))break;for(o(),o();n&&("*"!==n||"/"!==d(0));)o();n&&(o(),o())}}}function p(e,t){var r,n,s="",i=0,a=!0,o=0;function d(){return n=e.charAt(o),o++,n}for(d(),"-"===n&&(s="-",d());n>="0"&&n<="9";)a&&("0"==n?i++:a=!1),s+=n,d();if(a&&i--,"."===n)for(s+=".";d()&&n>="0"&&n<="9";)s+=n;if("e"===n||"E"===n)for(s+=n,d(),"-"!==n&&"+"!==n||(s+=n,d());n>="0"&&n<="9";)s+=n,d();for(;n&&n<=" ";)d();return t&&(","!==n&&"}"!==n&&"]"!==n&&"#"!==n&&("/"!==n||"/"!==e[o]&&"*"!==e[o])||(n=0)),r=+s,n||i||!isFinite(r)?void 0:r}function f(e){function t(e,r){var n,s,i,a;switch(typeof e){case"string":e.indexOf(r)>=0&&(a=e);break;case"object":if("[object Array]"===Object.prototype.toString.apply(e))for(n=0,i=e.length;n<i;n++)a=t(e[n],r)||a;else for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a=t(e[s],r)||a)}return a}function r(r){var n=t(e,r);return n?"found '"+r+"' in a string value, your mistake could be with:\n  > "+n+"\n  (unquoted strings contain everything up to the next line!)":""}return r("}")||r("]")}function m(){var e=[];try{if(o(),c(),"]"===n)return o(),e;for(;n;){if(e.push(y()),c(),","===n&&(o(),c()),"]"===n)return o(),e;c()}a("End of input while parsing an array (missing ']')")}catch(t){throw t.hint=t.hint||f(e),t}}function v(e){var t="",r={};try{if(e||o(),c(),"}"===n&&!e)return o(),r;for(;n;){if(t=u(),c(),":"!==n&&a("Expected ':' instead of '"+n+"'"),o(),r[t]=y(),c(),","===n&&(o(),c()),"}"===n&&!e)return o(),r;c()}if(e)return r;a("End of input while parsing an object (missing '}')")}catch(e){throw e.hint=e.hint||f(r),e}}function y(){switch(c(),n){case"{":return v();case"[":return m();case"'":case'"':return h(!0);default:return function(){var e=n;for(i(n)&&a("Found a punctuator character '"+n+"' when expecting a quoteless string (check your syntax)");;){o();var t="\r"===n||"\n"===n||""===n;if(t||","===n||"}"===n||"]"===n||"#"===n||"/"===n&&("/"===d(0)||"*"===d(0))){var r=e[0];switch(r){case"f":if("false"===e.trim())return!1;break;case"n":if("null"===e.trim())return null;break;case"t":if("true"===e.trim())return!0;break;default:if("-"===r||r>="0"&&r<="9"){var s=p(e);if(void 0!==s)return s}}if(t)return e.trim()}e+=n}}()}}function g(e){return c(),n&&a("Syntax error, found trailing characters"),e}if("string"!=typeof e)throw new Error("source is not a string");return t=e,r=0,n=" ",function(){switch(c(),n){case"{":return g(v());case"[":return g(m());default:return g(y())}}()}),dmx.Flow=dmx.createClass({constructor:function(e){if(!(this instanceof dmx.Flow))return new dmx.Flow(e);window.Promise||console.warn("Promises are not supported, flows can not be used"),this._execStep=this._execStep.bind(this),this.scope=new dmx.DataScope({},e),this.output={}},run:function(e){var t=this;return this.output={},this._exec(e.exec||e).then((function(){return dmx.debug&&console.debug("finished",t.output),t.output}))},_each:function(e,t){return Promise.resolve(e).then((function(e){return(e=Array.isArray(e)?e:[e]).reduce((function(r,n,s){return r.then((function(){return t(n,s,e.length).then((function(t){t&&(e[s]=t)}))}))}),Promise.resolve()).then((function(){return e}))}))},_exec:function(e){var t=this;if(e.steps){var r=this._each(e.steps,this._execStep);return e.catch&&r.catch((function(r){return t._each(e.catch,t._execStep)})),r}return this._each(e,this._execStep)},_execStep:function(e){var t=this;for(var r in dmx.debug&&console.debug("exec step",e),e){if(e.hasOwnProperty(r)&&dmx.__actions[r]){var n=dmx.__actions[r].bind(this),s=e[r];return dmx.debug&&console.debug("exec action",r,s),s.disabled?Promise.resolve():Promise.resolve(n(s)).then((function(e){s.name&&(dmx.debug&&console.debug("set data",s.name,e),t.scope.set(s.name,e),s.output&&(dmx.debug&&console.debug("set output",s.name,e),t.output[s.name]=e))}))}throw new Error("Action "+r+" was not found.")}},parse:function(e){if(null==e)return e;if("object"==typeof(e=e.valueOf())){var t=e.slice?[]:{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=this.parse(e[r],this.scope));return t}return"string"==typeof e&&-1!=e.indexOf("{{")?dmx.parse(e,this.scope):e}}),dmx.Flow.run=function(e,t){return new dmx.Flow(t).run(e)},dmx.Component("app",{initialData:{query:{}},events:{ready:Event,load:Event},init(){this.dispatchLoad=this.dispatchEvent.bind(this,"load"),this._parseQuery=this._parseQuery.bind(this),window.addEventListener("load",this.dispatchLoad,{once:!0}),window.addEventListener("load",this._parseQuery),window.addEventListener("popstate",this._parseQuery),window.addEventListener("pushstate",this._parseQuery),window.addEventListener("replacestate",this._parseQuery),this._parseQuery(),queueMicrotask((()=>this.dispatchEvent("ready")))},destroy(){window.removeEventListener("load",this.dispatchLoad),window.removeEventListener("load",this._parseQuery),window.removeEventListener("popstate",this._parseQuery),window.removeEventListener("pushstate",this._parseQuery),window.removeEventListener("replacestate",this._parseQuery)},_parseQuery(){let e="";window.location.search?e=window.location.search.slice(1):window.location.hash.indexOf("?")&&(e=window.location.hash.slice(window.location.hash.indexOf("?")+1),e.indexOf("#")>0&&(e=e.slice(0,e.indexOf("#"))));let t=e.split("&").reduce((function(e,t){var r=t.replace(/\+/g," ").split("=");return r[0]&&(e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")),e}),{}),r=document.querySelector('meta[name="ac:base"]'),n=document.querySelector('meta[name="ac:route"]');if(n&&n.content){let e=[],s=n.content;r&&r.content&&(s=r.content.replace(/\/$/,"")+s);let i=dmx.pathToRegexp(s,e,{end:!1}).exec(decodeURI(window.location.pathname));i&&e.forEach((function(e,r){t[e.name]=i[r+1]}))}this.set("query",t)}}),dmx.Component("form",{attributes:{novalidate:{type:Boolean,default:!1}},methods:{submit(e){this._submit(e)},reset(){this._reset()},validate(){this._validate()}},events:{invalid:Event,submit:Event},init(e){this._submitHandler=this._submitHandler.bind(this),this._resetHandler=this._resetHandler.bind(this),e.noValidate=!0,e.addEventListener("submit",this._submitHandler),e.addEventListener("reset",this._resetHandler)},destroy(){this.$node.removeEventListener("submit",this._submitHandler),this.$node.removeEventListener("reset",this._resetHandler)},_submitHandler(e){e.preventDefault(),this._submit()},_resetHandler(e){dmx.validateReset&&dmx.validateReset(this.$node),window.grecaptcha&&this.$node.querySelector(".g-recaptcha")&&grecaptcha.reset()},_submit(e){if(e)return this._formSubmit();this.props.novalidate||this._validate()?this.dispatchEvent("submit",{cancelable:!0})&&this._formSubmit():(this.dispatchEvent("invalid"),this._focusFirstInvalid())},_reset(){this._formReset()},_validate(){return dmx.validate?dmx.validate(this.$node):(Array.from(this.$node.elements).forEach((e=>e.dirty=!0)),this.$node.checkValidity())},_formSubmit(){HTMLFormElement.prototype.submit.call(this.$node)},_formReset(){HTMLFormElement.prototype.reset.call(this.$node)},_focusFirstInvalid(){const e=Array.from(this.$node.elements).find((e=>!e.validity.valid));e&&e.focus()},_parseJsonForm(){const e={};for(const n of this.$node.elements)if(n.name&&!n.disabled){const s=t(n.name.replace(/\[\]$/,""));let i=e;for(const e of s){const t=n.type;"number"==t?n.value&&(i=r(i,e,i[e.key],+n.value)):"radio"==t||"checkbox"==t?n.getAttribute("value")?n.checked&&(i=r(i,e,i[e.key],n.value)):i=r(i,e,i[e.key],n.checked):i=r(i,e,i[e.key],"select-multiple"==t?Array.from(n.selectedOptions).map((e=>e.value)):n.value)}}return e;function t(e){const t=[],r=e,n=/^\[([^\]]*)\]/,s=/^\d+$/;if(!(e=e.replace(/^([^\[]+)/,((e,r)=>(t.push({type:"object",key:r}),"")))))return t[0].last=!0,t;for(;e;){if(!n.test(e))return{type:"object",key:r,last:!0};e=e.replace(n,((e,r)=>(r?s.test(r)?t.push({type:"array",key:+r}):t.push({type:"object",key:r}):t[t.length-1].append=!0,"")))}for(let e=0,r=t.length;e<r;e++){const n=t[e];e+1<r?n.nextType=t[e+1].type:n.last=!0}return t}function r(e,t,n,s){if(t.last){if(void 0===n)e[t.key]=t.append?[s]:s;else if(Array.isArray(n))e[t.key].push(s);else{if("object"==typeof n)return r(n,{type:"object",key:"",last:!0},n[""],s);e[t.key]=[n,s]}return e}if(void 0===n)return e[t.key]="array"==t.nextType?[]:{};if(Array.isArray(n)){if("array"==t.nextType)return n;const r={};for(let e=0,t=n.length;e<t;e++)void 0!==n[e]&&(r[e]=n[e]);return e[t.key]=r}return"object"==typeof n?e[t.key]:e[t.key]={"":n}}}}),dmx.Component("form-element",{initialData:{disabled:!1,focused:!1,invalid:!1,validationMessage:"",value:""},attributes:{value:{type:String,default:""},disabled:{type:Boolean,default:!1}},methods:{setValue(e){this._setValue(e)},focus(){this._focus()},disable(e){this._disable(e)},validate(){this._validate()}},events:{updated:Event,changed:Event},init(e){this._inputHandler=this._inputHandler.bind(this),this._changeHandler=this._changeHandler.bind(this),this._invalidHandler=this._invalidHandler.bind(this),this._resetHandler=this._resetHandler.bind(this),this._focusHandler=this._focusHandler.bind(this),this._blurHandler=this._blurHandler.bind(this),e.value=this.props.value||"",e.defaultValue=e.value,e.disabled=this.props.disabled,e.addEventListener("input",this._inputHandler),e.addEventListener("change",this._changeHandler),e.addEventListener("invalid",this._invalidHandler),e.addEventListener("focus",this._focusHandler),e.addEventListener("blur",this._blurHandler),e.form&&e.form.addEventListener("reset",this._resetHandler),this.set("value",this.props.value),this.$node===document.activeElement&&this.set("focused",!0)},destroy(){this.$node.removeEventListener("input",this._inputHandler),this.$node.removeEventListener("change",this._changeHandler),this.$node.removeEventListener("invalid",this._invalidHandler),this.$node.removeEventListener("focus",this._focusHandler),this.$node.removeEventListener("blur",this._blurHandler),this.$node.form&&this.$node.form.removeEventListener("reset",this._resetHandler)},performUpdate(e){e.has("value")&&this._setValue(this.props.value,!0),e.has("disabled")&&this._disable(this.props.disabled)},_setValue(e,t){this.$node.value=e||"",t&&(this.$node.defaultValue=e||""),this.set("value",e),this.dispatchEvent("updated")},_focus(){this.$node.focus()},_disable(e){this.$node.disabled=e,this.set("disabled",this.$node.disabled)},_validate(){dmx.validate(this.$node),this.$node.dirty&&this.set({invalid:!this.$node.validity.valid,validationMessage:this.$node.validationMessage})},_inputHandler(e){this.$node.dirty&&this._validate(),dmx.nextTick((()=>{this.data.value!==this.$node.value&&(this.set("value",this.$node.value),e&&this.dispatchEvent("changed"),this.dispatchEvent("updated"))}))},_changeHandler(e){this.$node.dirty&&this._validate(),dmx.nextTick((()=>{this.data.value!==this.$node.value&&(this.set("value",this.$node.value),e&&this.dispatchEvent("changed"),this.dispatchEvent("updated"))}))},_invalidHandler(e){this.set({invalid:!this.$node.validity.valid,validationMessage:this.$node.validationMessage})},_resetHandler(e){this.$node.dirty=!1,this.set({invalid:!1,validationMessage:""}),this._changeHandler()},_focusHandler(e){this.set("focused",!0)},_blurHandler(e){this.set("focused",!1)}}),dmx.Component("textarea",{extends:"form-element",init(e){if(!this.props.value){const e=this.$node.value;this.props.value=e.includes("{{")?this.parse(e):e}dmx.Component("form-element").prototype.init.call(this,e)}}),dmx.Component("input",{extends:"form-element"}),dmx.Component("input-file",{extends:"form-element",initialData:{file:null},_setValue(e){console.warn("Can not set value of a file input!")},_changeHandler(e){dmx.Component("form-element").prototype._changeHandler.call(this,e);let t=null;if(this.$node.files.length){const e=this,r=this.$node.files[0];let n=null,s=!1;t={date:(r.lastModified?new Date(r.lastModified):r.lastModifiedDate).toISOString(),name:r.name,size:r.size,type:r.type,get dataUrl(){return n||s||(s=!0,dmx.fileUtils.blobToDataURL(r).then((r=>{e.set("file",Object.assign({},t,{dataUrl:r}))})).catch((e=>{console.error(e)}))),n}}}this.set("file",t)}}),dmx.Component("input-file-multiple",{extends:"form-element",initialData:{files:[]},_setValue(e){console.warn("Can not set value of a file input!")},_changeHandler(e){dmx.Component("form-element").prototype._changeHandler.call(this,e);let t=[];if(this.$node.files.length){const e=this;t=Array.from(this.$node.files).map(((r,n)=>{let s=!1;const i={date:(r.lastModified?new Date(r.lastModified):r.lastModifiedDate).toISOString(),name:r.name,size:r.size,type:r.type,get dataUrl(){return s||(s=!0,dmx.fileUtils.blobToDataURL(r).then((r=>{t=dmx.clone(t),t[n].dataUrl=r,e.set("files",t)})).catch((e=>{console.error(e)}))),null}};return i}))}this.set("files",t)}}),dmx.Component("button",{extends:"form-element",attributes:{type:{type:String,default:"button",enum:["button","reset","submit"]}},init(e){dmx.Component("form-element").prototype.init.call(this,e),e.type=this.props.type}}),dmx.Component("radio",{extends:"form-element",initialData:{checked:!1},attributes:{checked:{type:Boolean,default:!1}},methods:{select(e){this._select(e)}},init(e){dmx.Component("form-element").prototype.init.call(this,e),e.type="radio",e.checked=this.props.checked,e.defaultChecked=this.props.checked,this.props.checked&&this.set("checked",!0)},performUpdate(e){dmx.Component("form-element").prototype.performUpdate.call(this,e),e.has("checked")&&(this.$node.defaultChecked=this.props.checked,this.$node.checked!=this.props.checked&&(this.$node.checked=this.props.checked,this.set("checked",this.props.checked),this.dispatchEvent("updated")))},_select(e){this.$node.checked=!1!==e,this.set("checked",this.$node.checked),this.dispatchEvent("updated"),this.dispatchEvent(this.$node.checked?"checked":"unchecked")},_changeHandler(e){if(this.$node.dirty&&this._validate(),this.set("checked",this.$node.checked),this.dispatchEvent("updated"),this.dispatchEvent(this.$node.checked?"checked":"unchecked"),this.$node.checked){const e=document.querySelectorAll(`input[type="radio"][name="${this.$node.name}"]`);for(const t of e)t!==this.$node&&t.dispatchEvent(new Event("change",{bubbles:!0}))}}}),dmx.Component("radio-group",{initialData:{value:null},attributes:{value:{type:String,default:null}},methods:{setValue(e){this._setValue(e)}},events:{updated:Event},init(e){this._changeHandler=this._changeHandler.bind(this),e.addEventListener("change",this._changeHandler),this._setValue(this.props.value,!0)},destroy(){this.$node.removeEventListener("change",this._changeHandler)},performUpdate(e){e.has("value")&&this._setValue(this.props.value,!0)},_setValue(e,t){null==e&&(e=""),e=e.toString(),this._radios().forEach((r=>{r.checked=r.value==e,t&&(r.defaultChecked=r.checked)})),this._updateValue()},_updateValue(){const e=this._radios().filter((e=>!e.disabled&&e.checked)).map((e=>e.value));dmx.equal(this.data.value,e[0])||(this.set("value",e[0]||null),this.dispatchEvent("updated"))},_radios(){return Array.from(this.$node.querySelectorAll("input[type=radio]"))},_changeHandler(e){this._updateValue()}}),dmx.Component("checkbox",{extends:"form-element",initialData:{checked:!1},attributes:{checked:{type:Boolean,default:!1}},methods:{select(e){this._select(e)}},events:{checked:Event,unchecked:Event},init(e){dmx.Component("form-element").prototype.init.call(this,e),e.type="checkbox",e.checked=this.props.checked,e.defaultChecked=this.props.checked,this.props.checked&&this.set("checked",!0)},performUpdate(e){dmx.Component("form-element").prototype.performUpdate.call(this,e),e.has("checked")&&(this.$node.defaultChecked=this.props.checked,this.$node.checked!=this.props.checked&&(this.$node.checked=this.props.checked,this.set("checked",this.props.checked),this.dispatchEvent("updated"),this.dispatchEvent(this.props.checked?"checked":"unchecked")))},_select(e){this.$node.checked=!1!==e,this.set("checked",this.$node.checked),this.dispatchEvent("updated"),this.dispatchEvent(this.$node.checked?"checked":"unchecked")},_changeHandler(e){this.$node.dirty&&this._validate(),this.set("checked",this.$node.checked),this.dispatchEvent("updated"),this.dispatchEvent("changed"),this.dispatchEvent(this.$node.checked?"checked":"unchecked")}}),dmx.Component("checkbox-group",{initialData:{value:[]},attributes:{value:{type:Array,default:[]}},methods:{setValue(e){this._setValue(e)}},events:{updated:Event},init(e){this._changeHandler=this._changeHandler.bind(this),e.addEventListener("change",this._changeHandler),this._setValue(this.props.value,!0)},destroy(){this.$node.removeEventListener("change",this._changeHandler)},performUpdate(e){e.has("value")&&this._setValue(this.props.value,!0)},_setValue(e,t){null==e&&(e=""),Array.isArray(e)||(e=[e]),e=e.map((e=>e.toString())),this._checkboxes().forEach((r=>{r.checkbox=e.includes(r.value),t&&(r.defaultChecked=r.checked)})),this._updateValue()},_updateValue(){const e=this._checkboxes().filter((e=>!e.disabled&&e.checked)).map((e=>e.value));dmx.equal(this.data.value,e)||(this.set("value",e),this.dispatchEvent("updated"))},_checkboxes(){return Array.from(this.$node.querySelectorAll("input[type=checkbox]"))},_changeHandler(e){this._updateValue()}}),dmx.Component("select",{extends:"form-element",initialData:{selectedIndex:-1,selectedValue:"",selectedText:""},attributes:{options:{type:Array,default:[]},optiontext:{type:String,default:"$value"},optionvalue:{type:String,default:"$value"}},methods:{setSelectedIndex(e){this.$node.selectedIndex=e,this._updateValue()}},init(e){this._options=[],this.props.value||(this.props.value=this.$node.value,this._updateValue()),this._mutationObserver=new MutationObserver((()=>{this._updatingOptions||this._updateValue()})),this._mutationObserver.observe(this.$node,{subtree:!0,childList:!0,attributes:!0}),dmx.Component("form-element").prototype.init.call(this,e)},render(e){this.$parse(),this._renderOptions();let t=this.props.value;null==t&&(t=""),Array.from(this.$node.options).forEach((e=>{e.toggleAttribute("selected",e.value==t),e.selected=e.value==t,e.defaultSelected=e.selected})),this._updateValue()},destroy(){this._mutationObserver.disconnect(),dmx.Component("form-element").prototype.destroy.call(this)},performUpdate(e){dmx.Component("form-element").prototype.performUpdate.call(this,e),(e.has("options")||e.has("optiontext")||e.has("optionvalue"))&&this._renderOptions()},_setValue(e,t){null==e&&(e=""),e=e.toString(),Array.from(this.$node.options).forEach((r=>{r.selected=r.value==e,t&&(r.defaultSelected=r.selected)})),this._updateValue()},_updateValue(){const e=this.$node.selectedIndex,t=this.$node.options[e]||{value:"",text:""};this.set({selectedIndex:e,selectedValue:t.value,selectedText:t.text,value:t.value})},_renderOptions(){this.props.options.length&&(this._options.splice(0).forEach((e=>e.remove())),this._updatingOptions=!0,dmx.repeatItems(this.props.options).forEach((e=>{const t=document.createElement("option");t.value=dmx.parse(this.props.optionvalue,dmx.DataScope(e,this)),t.textContent=dmx.parse(this.props.optiontext,dmx.DataScope(e,this)),t.value==this.props.value&&(t.selected=!0),this.$node.append(t),this._options.push(t)})),this._updatingOptions=!1,this._updateValue())},_inputHandler(e){},_changeHandler(e){this.$node.dirty&&this._validate(),dmx.nextTick((()=>{this.data.selectedIndex!==this.$node.selectedIndex&&(this._updateValue(),this.dispatchEvent("changed"),this.dispatchEvent("updated"))}))}}),dmx.Component("select-multiple",{extends:"select",initialData:{value:[]},attributes:{value:{type:Array,default:null}},performUpdate(e){dmx.Component("select").prototype.performUpdate.call(this,e),e.has("value")&&this._setValue(this.props.value,!0)},_setValue(e,t){null==e&&(e=""),Array.isArray(e)||(e=[e]),e=e.map((e=>e.toString())),Array.from(this.$node.options).forEach((r=>{r.selected=e.includes(r.value),t&&(r.defaultSelected=r.selected)})),this._updateValue()},_updateValue(){const e=Array.from(this.$node.options).filter((e=>e.selected)).map((e=>e.value));dmx.batch((()=>{dmx.Component("select").prototype._updateValue.call(this),this.set("value",e)}))}}),dmx.Component("value",{initialData:{value:null},attributes:{value:{default:null}},methods:{setValue(e){this.data.value!==e&&(this.set("value",e),this.dispatchEvent("updated"))}},events:{updated:Event},render:!1,init(e){this.set("value",this.props.value)},performUpdate(e){e.has("value")&&(this.set("value",this.props.value),this.dispatchEvent("updated"))}}),dmx.Component("repeat",{initialData:{items:[]},attributes:{repeat:{type:[Array,Object,Number],default:null},key:{type:String,default:""},rerender:{type:Boolean,default:!1}},events:{update:Event,updated:Event},render:!1,init(e){for(this.prevItems=[],this.childKeys={},this.$template=document.createDocumentFragment();this.$node.hasChildNodes();)this.$template.appendChild(this.$node.firstChild);this.props.repeat&&this.performUpdate(new Map([["repeat",void 0]]))},performUpdate(e){if(e.has("key")&&(this._rerender=!0),e.has("repeat")){this.dispatchEvent("update"),(this.props.rerender||this._rerender)&&(this._rerender=!1,this._clear());var t=dmx.Component("repeat-item"),r=dmx.clone(this.props.repeat),n=dmx.repeatItems(r);if(n.length){if(!this.props.rerender&&this.props.key&&n[0].hasOwnProperty(this.props.key)&&this.prevItems.length){var s,i,a=this.props.key,o=this.prevItems,d=this._clone(n),h=0,l=0,u=o.length-1,c=d.length-1;e:for(;;){for(;o[h][a]===d[l][a];)if(this.childKeys[d[l][a]].set(d[l]),l++,++h>u||l>c)break e;for(;o[u][a]===d[c][a];)if(this.childKeys[d[c][a]].set(d[c]),c--,h>--u||l>c)break e;if(o[u][a]!==d[l][a]){if(o[h][a]!==d[c][a])break;if(i=c+1,this.childKeys[d[c][a]].set(d[c]),this._moveChild(d[c][a],d[i]&&d[i][a]),c--,++h>u||l>c)break}else if(this.childKeys[d[l][a]].set(d[l]),this._moveChild(d[l][a],o[h][a]),l++,h>--u||l>c)break}if(h>u)for(i=c+1;l<=c;)this._insertChild(d[l++],d[i]&&d[i][a]);else if(l>c)for(;h<=u;)this._removeChild(o[h++][a]);else{var p=u-h+1,f=c-l+1,m=o,v=new Array(f).fill(-1),y=!1,g=0,_=0;if(f<=4||p*f<=16){for(E=h;E<=u;E++)if(_<f)for(s=l;s<=c;s++)if(o[E][a]===d[s][a]){v[s-l]=E,g>s?y=!0:g=s,this.childKeys[d[s][a]].set(d[s]),_++,m[E]=null;break}}else{var x={};for(E=l;E<=c;E++)x[d[E][a]]=E;for(E=h;E<=u;E++)_<f&&void 0!==(s=x[o[E][a]])&&(v[s-l]=E,g>s?y=!0:g=s,this.childKeys[d[s][a]].set(d[s]),_++,m[E]=null)}if(p===o.length&&0===_)for(this._clear();l<f;)this._insertChild(d[l++],null);else{for(E=p-_;E>0;)null!==m[h]&&(this._removeChild(o[h][a]),E--),h++;if(y){var b=this._lis(v);for(s=b.length-1,E=f-1;E>=0;E--)-1===v[E]?(i=(g=E+l)+1,this._insertChild(d[g],d[i]&&d[i][a])):s<0||E!==b[s]?(i=(g=E+l)+1,this._moveChild(d[g][a],d[i]&&d[i][a])):s--}else if(_!==f)for(E=f-1;E>=0;E--)-1===v[E]&&(i=(g=E+l)+1,this._insertChild(d[g],d[i]&&d[i][a]))}}}else if(this.children.length>n.length&&this.children.splice(n.length).forEach((function(e){e.$destroy()})),this.children.length&&this.children.forEach((function(e,t){e.set(n[t])})),n.length>this.children.length){for(var w=document.createDocumentFragment(),E=this.children.length;E<n.length;E++){var $=new t(this.$template.cloneNode(!0),this,n[E]);$.$nodes.forEach((function(e){w.appendChild(e),$.$parse(e)})),this.children.push($)}this.$node.appendChild(w)}}else this._clear();this.props.key&&(this.prevItems=this._clone(n),this.children.forEach((function(e){this.childKeys[e.data[this.props.key]]=e}),this)),this.set("items",this.children.map((e=>e.data))),dmx.nextTick((()=>this.dispatchEvent("updated")))}},_lis(e){var t,r,n=e.slice(0),s=[];s.push(0);for(var i=0,a=e.length;i<a;i++)if(-1!==e[i]){var o=s[s.length-1];if(e[o]<e[i])n[i]=o,s.push(i);else{for(t=0,r=s.length-1;t<r;){var d=(t+r)/2|0;e[s[d]]<e[i]?t=d+1:r=d}e[i]<e[s[t]]&&(t>0&&(n[i]=s[t-1]),s[t]=i)}}for(r=s[(t=s.length)-1];t-- >0;)s[t]=r,r=n[r];return s},_clear(){this.prevItems=[],this.childKeys={},this.children.splice(0).forEach((function(e){e.$destroy()})),this.$node.innerHTML=""},_insertChild(e,t){var r=new(dmx.Component("repeat-item"))(this.$template.cloneNode(!0),this,e);r.$nodes.forEach((function(e){t?this.childKeys[t]?this.$node.insertBefore(e,this.childKeys[t].$nodes[0]):console.warn("(insert) can not insert node before key "+t+"!"):this.$node.appendChild(e),r.$parse(e)}),this),this.childKeys[e[this.props.key]]=r,this.children.push(r)},_moveChild(e,t){var r=this.childKeys[e];r?this.childKeys[t]?r.$nodes.forEach((function(e){this.$node.insertBefore(e,this.childKeys[t].$nodes[0])}),this):r.$nodes.forEach((function(e){this.$node.appendChild(e)}),this):console.warn("(move) child with key "+e+" not found!")},_removeChild(e){var t=this.childKeys[e];t?(t.$destroy(),this.children.splice(this.children.indexOf(t),1),delete this.childKeys[e]):console.warn("(remove) child with key "+e+" not found!")},_clone:e=>dmx.clone(e)}),dmx.Component("repeat-item",{constructor:function(e,t,r,n){this.parent=t,this.bindings={},this.propBindings={},this.children=[],this.listeners=[],this._prevProps={},this._updatedProps=new Set,this.updatedProps=new Map,this.updateRequested=!1,this.isInitialized=!0,this.isDestroyed=!1,this.data=dmx.signalProxy(r),this.seed=t.seed,this.name=n||"repeatItem",this.$nodes=[];for(var s=0;s<e.childNodes.length;s++)this.$nodes.push(e.childNodes[s])},destroy(){for(const e of this.$nodes){const t=new Event("remove",{cancelable:!0});e.dispatchEvent(t)&&dmx.dom.remove(e)}}}),dmx.Component("fetch",{initialData:{status:0,data:null,links:{},paging:{},headers:{},state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,percent:0,total:0},downloadProgress:{position:0,percent:0,total:0},lastError:{status:0,message:"",response:null}},attributes:{timeout:{type:Number,default:0},method:{type:String,default:"GET",enum:["GET","POST","PUT","DELETE"]},url:{type:String,default:""},params:{type:Object,default:{}},headers:{type:Object,default:{}},data:{type:Object,default:{}},dataType:{type:String,default:"auto",enum:["auto","json","text"]},noload:{type:Boolean,default:!1},cache:{type:String,default:""},ttl:{type:Number,default:86400},credentials:{type:Boolean,default:!1}},methods:{abort(){this._abort()},load(e,t){const r={};e&&(r.params=e),t&&(r.ttl=0),this._fetch(r)},reset(){this._abort(),this._resetData(!0)}},events:{start:Event,done:Event,error:Event,invalid:Event,unauthorized:Event,forbidden:Event,abort:Event,success:Event,upload:ProgressEvent,download:ProgressEvent},_statusEvents:{400:"invalid",401:"unauthorized",403:"forbidden"},render:!1,init(e){this._fetch=dmx.debounce(this._fetch.bind(this)),this._loadHandler=this._loadHandler.bind(this),this._abortHandler=this._abortHandler.bind(this),this._errorHandler=this._errorHandler.bind(this),this._timeoutHandler=this._timeoutHandler.bind(this),this._downloadProgressHandler=this._progressHandler.bind(this,"download"),this._uploadProgressHandler=this._progressHandler.bind(this,"upload"),this._xhr=new XMLHttpRequest,this._xhr.addEventListener("load",this._loadHandler),this._xhr.addEventListener("abort",this._abortHandler),this._xhr.addEventListener("error",this._errorHandler),this._xhr.addEventListener("timeout",this._timeoutHandler),this._xhr.addEventListener("progress",this._downloadProgressHandler),this._xhr.upload.addEventListener("progress",this._uploadProgressHandler),!this.props.noload&&this.props.url&&this._fetch()},destroy(){this._xhr.removeEventListener("load",this._loadHandler),this._xhr.removeEventListener("abort",this._abortHandler),this._xhr.removeEventListener("error",this._errorHandler),this._xhr.removeEventListener("timeout",this._timeoutHandler),this._xhr.removeEventListener("progress",this._downloadProgressHandler),this._xhr.upload.removeEventListener("progress",this._uploadProgressHandler),this._xhr.abort(),this._xhr=null},performUpdate(e){!this.props.noload&&this.props.url&&(e.has("url")||e.has("params"))&&this._fetch()},$parseAttributes(e){dmx.BaseComponent.prototype.$parseAttributes.call(this,e),dmx.dom.getAttributes(e).forEach((({name:e,argument:t,value:r})=>{t&&r&&["param","header"].includes(e)&&this.$watch(r,(r=>{this.props[e+"s"]=Object.assign({},this.props[e+"s"],{[t]:r})})),t&&r&&"data"==e&&this.$watch(r,(e=>{this.props.data=Object.assign({},this.props.data,{[t]:e})}))}))},_abort(){this._xhr&&this._xhr.abort()},_resetData(e){const t={status:0,headers:{},state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0},lastError:{status:0,message:"",response:null}};e&&(t.data=null),this.set(t)},_fetch(e){this._abort(),e=dmx.extend(!0,this.props,e||{});let t=Object.keys(e.params).filter((t=>null!=e.params[t])).map((t=>{let r=e.params[t];return"string"==typeof r&&r.startsWith("{{")&&(r=this.parse(r)),encodeURIComponent(t)+"="+encodeURIComponent(r)})).join("&");if(this._resetData(),this.dispatchEvent("start"),this._url=e.url,t&&(this._url+=(this._url.includes("?")?"&":"?")+t),window.WebviewProxy&&(this._url=window.WebviewProxy.convertProxyUrl(this._url)),this.props.cache){const t=this.parse(`${this.props.cache}.data["${this._url}"]`);if(t){if(!(Date.now()-t.created>=1e3*e.ttl))return this.set({headers:t.headers||{},paging:t.paging||{},links:t.links||{},data:t.data}),this.dispatchEvent("success"),void this.dispatchEvent("done");this.parse(`${this.props.cache}.remove("${this._url}")`)}}this.set("state",{executing:!0,uploading:!1,processing:!1,downloading:!1});let r=null;"GET"!==this.props.method&&("text"===this.props.dataType?r=this.props.data.toString():"json"===this.props.dataType?r=JSON.stringify(this.props.data):"POST"===this.props.method?(r=new FormData,Object.keys(this.props.data).forEach((e=>{let t=this.props.data[e];Array.isArray(t)?(/\[\]$/.text(t)||(e+="[]"),t.forEach((t=>r.append(e,t)))):r.set(e,t)}))):r=this.props.data.toString()),this._xhr.open(this.props.method,this._url),this._xhr.timeout=1e3*e.timeout,"json"!==this.props.dataType&&"text"!==this.props.dataType||this._xhr.setRequestHeader("Content-Type","application/"+this.props.dataType);for(const e in this.props.headers)this._xhr.setRequestHeader(e,this.props.headers[e]);this._xhr.setRequestHeader("accept","application/json"),this.props.credentials&&(this._xhr.withCredentials=!0);try{this._xhr.send(r)}catch(e){this._done(e)}},_done(e){if(this._resetData(),e)return this.set("lastError",{status:0,message:e.message,response:null}),this.dispatchEvent("error"),void this.dispatchEvent("done");let t=this._xhr.responseText;try{t=JSON.parse(t)}catch(e){if(this._xhr.status<400)return this.set("lastError",{status:0,message:"Response was not valid JSON",response:t}),this.dispatchEvent("error"),void this.dispatchEvent("done")}if(this._parseHeaders(),this._xhr.status<400)return this.set({status:this._xhr.status,data:t}),this.dispatchEvent("success"),this.dispatchEvent("done"),void(this.props.cache&&this.parse(`${this.props.cache}.set("${this._url}", { headers: headers, paging: paging, links: links, data: data, created: ${Date.now()} })`));this.set({status:this._xhr.status,lastError:{status:this._xhr.status,message:this._xhr.statusText,response:t}}),this.dispatchEvent(this._statusEvents[this._xhr.status]||"error"),this.dispatchEvent("done")},_parseHeaders(){try{const e=this._xhr.getAllResponseHeaders().trim().split(/[\r\n]+/);this.set("headers",e.reduce(((e,t)=>{const r=t.split(": "),n=r.shift(),s=r.join(": ");return e[n]=s,e}),{}))}catch(e){return void console.warn("Error parsing response headers",e)}this._parseLinkHeaders()},_parseLinkHeaders(){try{const e=Object.keys(this.data.headers).find((e=>"link"===e.toLowerCase()));e&&this.set("links",this.data.headers[e].split(/,\s*</).map((e=>{try{const t=e.match(/<?([^>]*)>(.*)/),r=new URL(t[1]),n=t[2].split(";"),s=r.search.slice(1).split("&").reduce(((e,t)=>{const r=t.split("=");return r[0]&&(e[decodeURIComponent[r[0]]]=decodeURIComponent(r[1]||"")),e}),{});let i=n.slice(1).reduce(((e,t)=>{const r=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return r&&(e[r[1]]=r[2]),e}),{});return i=Object.assign({},s,i),i.url=r.toString(),i}catch(e){return console.warn("Error parsing link header part",e),null}}))).filter((e=>e&&e.rel)).reduce(((e,t)=>(t.rel.split(/\s+/).forEach((r=>e[r]=Object.assign(t,{rel:r}))),e)),{})}catch(e){return void console.warn("Error parsing link header",e)}this._parsePaging()},_parsePaging(){try{const e={page:1,pages:1,items:0,has:{first:!1,prev:!1,next:!1,last:!1}},{first:t,prev:r,next:n,last:s}=this.data.links;if(r||n){s&&s.page?e.pages=+s.page:r&&r.page&&(e.pages=+r.page+1);const i=Object.keys(this.data.headers).find((e=>"x-total"===(e=e.toLowerCase())||"x-count"===e||"x-total-count"===e));i&&(e.items=+this.data.headers[i]),r&&r.page?e.page=+r.page+1:n&&n.page&&(e.page=+n.page-1),e.has={first:!!t,prev:!!r,next:!!n,last:!!s}}this.set("paging",e)}catch(e){console.warn("Error parsing paging",e)}},_loadHandler(e){this._done()},_abortHandler(e){this._resetData(),this.dispatchEvent("abort"),this.dispatchEvent("done")},_errorHandler(e){this._done(Error("Failed to execute"))},_timeoutHandler(e){this._done(Error("Execution timeout"))},_progressHandler(e,t){t.loaded=t.loaded||t.position;const r=t.lengthComputable?Math.ceil(100*t.loaded/t.total):0;this.set({state:{executing:!0,uploading:"upload"===e&&r<100,processing:"upload"===e&&100===r,downloading:"download"===e},[e+"Progress"]:{position:t.loaded,total:t.total,percent:r}}),this.dispatchEvent(e,{lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total})}}),dmx.Component("serverconnect",{extends:"fetch",attributes:{sockets:{type:Boolean,default:!1}},init(e){this.props.sockets&&dmx.Socket&&(this._refresh=this._refresh.bind(this),this._event=this.props.url.replace(/^(.*?)api\//,""),this._socket=dmx.Socket("/api"),this._socket.on(this._event,this._refresh)),dmx.Component("fetch").prototype.init.call(this,e)},destroy(){this._socket&&this._socket.off(this._event,this._refresh),dmx.Component("fetch").prototype.destroy.call(this)},_fetch(e){this._socket&&this._socket.connected?this._refresh(e&&e.params):dmx.Component("fetch").prototype._fetch.call(this,e)},_refresh(e){e=dmx.extend(!0,{},this.props.params,e||{}),this.dispatchEvent("start"),this.set("state",{executing:!0,uploading:!1,processing:!0,downloading:!1}),this._socket.emit(this._event,e,(e=>{this.set({status:e.status,data:e.data,state:{executing:!1,uploading:!1,processing:!1,downloading:!1}}),this.dispatchEvent(this._statusEvents[e.status]||"error"),this.dispatchEvent("done")}))}}),dmx.Component("serverconnect-form",{extends:"form",initialData:{status:0,data:null,headers:{},state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0},lastError:{status:0,message:"",response:null}},attributes:{timeout:{type:Number,default:0},autosubmit:{type:Boolean,default:!1},params:{type:Object,default:{}},headers:{type:Object,default:{}},postdata:{type:String,default:"form"},credentials:{type:Boolean,default:!1}},methods:{abort(){this._abort()},reset(e){this._reset(),e&&(this._abort(),this._resetData(!0))}},events:{start:Event,done:Event,error:Event,unauthorized:Event,forbidden:Event,abort:Event,success:Event,upload:ProgressEvent,download:ProgressEvent},init(e){dmx.Component("form").prototype.init.call(this,e),this._loadHandler=this._loadHandler.bind(this),this._abortHandler=this._abortHandler.bind(this),this._errorHandler=this._errorHandler.bind(this),this._timeoutHandler=this._timeoutHandler.bind(this),this._downloadProgressHandler=this._progressHandler.bind(this,"download"),this._uploadProgressHandler=this._progressHandler.bind(this,"upload"),this._xhr=new XMLHttpRequest,this._xhr.addEventListener("load",this._loadHandler),this._xhr.addEventListener("abort",this._abortHandler),this._xhr.addEventListener("error",this._errorHandler),this._xhr.addEventListener("timeout",this._timeoutHandler),this._xhr.addEventListener("progress",this._downloadProgressHandler),this._xhr.upload.addEventListener("progress",this._uploadProgressHandler),this._extendNode(e),this.props.autosubmit&&dmx.nextTick((()=>this._submit()))},destroy(){dmx.Component("form").prototype.destroy.call(this),this._xhr.removeEventListener("load",this._loadHandler),this._xhr.removeEventListener("abort",this._abortHandler),this._xhr.removeEventListener("error",this._errorHandler),this._xhr.removeEventListener("timeout",this._timeoutHandler),this._xhr.removeEventListener("progress",this._downloadProgressHandler),this._xhr.upload.removeEventListener("progress",this._uploadProgressHandler),this._xhr=null},$parseAttributes(e){dmx.BaseComponent.prototype.$parseAttributes.call(this,e),dmx.dom.getAttributes(e).forEach((({name:e,argument:t,value:r})=>{t&&r&&["param","header"].includes(e)&&this.$watch(r,(r=>{this.props[e+"s"]=Object.assign({},this.props[e+"s"],{[t]:r})}))}))},_extendNode(e){const t=e.checkValidity;e.dmxExtraData={},e.dmxExtraElements=[],e.checkValidity=function(){for(const t of e.dmxExtraElements)"function"==typeof t.validate&&t.validate();return t.call(e)}},_abort(){this._xhr.abort()},_resetData(e){const t={status:0,headers:{},state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0},lastError:{status:0,message:"",response:null}};e&&(t.data=null),this.set(t)},_formSubmit(){this._send()},_send(){this._abort();const e=this.$node.method.toUpperCase(),t=this.$node.action;let r=null,n=Object.keys(this.props.params).filter((e=>null!=this.props.params[e])).map((e=>{let t=this.props.params[e];return"string"==typeof t&&t.startsWith("{{")&&(t=this.parse(t)),encodeURIComponent(e)+"="+encodeURIComponent(t)})).join("&");if("GET"===e)n.length&&(n+="&"),n+=Array.from(this.$node.elements).filter((e=>!e.disabled&&("radio"!==e.type&&"checkbox"!==e.type||e.checked))).map((e=>encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))).join("&");else if("json"===this.props.postdata)r=this._parseJsonForm(),this.$node.dmxExtraData&&Object.assign(r,this.$node.dmxExtraData),r=JSON.stringify(r);else if(r=new FormData(this.$node),this.$node.dmxExtraData)for(let e in this.$node.dmxExtraData){let t=this.$node.dmxExtraData[e];Array.isArray(t)?(/\[\]$/.test(e)||(e+="[]"),t.forEach((t=>r.append(e,t)))):r.set(e,t)}this._resetData(),this.dispatchEvent("start"),this.set("state",{executing:!0,uploading:!1,processing:!1,downloading:!1});let s=t;n&&(s+=(s.contains("?")?"&":"?")+n),window.WebviewProxy&&(s=window.WebviewProxy.convertProxyUrl(s)),this._xhr.open(e,s),this._xhr.timeout=1e3*this.props.timeout,"json"===this.props.postdata&&this._xhr.setRequestHeader("Content-Type","application/json");for(const e in this.props.headers)this._xhr.setRequestHeader(e,this.props.headers[e]);this._xhr.setRequestHeader("accept","application/json"),this.props.credentials&&(this._xhr.withCredentials=!0);try{this._xhr.send(r)}catch(e){this._done(e)}},_done(e){if(this._resetData(),e)return this.set("lastError",{status:0,message:e.message,response:null}),this.dispatchEvent("error"),void this.dispatchEvent("done");let t=this._xhr.responseText;try{t=JSON.parse(t)}catch(e){if(this._xhr.status<400)return this.set("lastError",{status:0,message:"Response was not valid JSON",response:t}),this.dispatchEvent("error"),void this.dispatchEvent("done")}try{const e=this._xhr.getAllResponseHeaders().trim().split(/[\r\n]+/);this.set("headers",e.reduce(((e,t)=>{const r=t.split(": "),n=r.shift(),s=r.join(": ");return e[n]=s,e}),{}))}catch(e){console.warn("Error parsing response headers",e)}if(dmx.validateReset&&dmx.validateReset(this.$node),window.grecaptcha&&this.$node.querySelector(".g-recaptcha")&&grecaptcha.reset(),this._xhr.status<400)return this.set({status:this._xhr.status,data:t}),this.dispatchEvent("success"),void this.dispatchEvent("done");if(this.set({status:this._xhr.status,lastError:{status:this._xhr.status,message:this._xhr.statusText,response:t}}),400===this._xhr.status)if(this.dispatchEvent("invalid"),t.form)for(const e in t.form){const r=this.$node.querySelector(`[name="${e}"]`);if(r){const n=t.form[e];r.setCustomValidity(n),dmx.bootstrap5forms?dmx.validate.setBootstrap5Message(r,n):dmx.bootstrap4forms?dmx.validate.setBootstrap4Message(r,n):dmx.bootstrap3forms?dmx.validate.setBootstrapMessage(r,n):dmx.validate.setErrorMessage(r,n)}}else dmx.debug&&console.warn("400 error, no form errors in response.",t);else 401===this._xhr.status?this.dispatchEvent("unauthorized"):403===this._xhr.status?this.dispatchEvent("forbidden"):this.dispatchEvent("error");this.dispatchEvent("done")},_loadHandler(e){this._done()},_abortHandler(e){this._resetData(),this.dispatchEvent("abort"),this.dispatchEvent("done")},_errorHandler(e){this._done(Error("Failed to execute"))},_timeoutHandler(e){this._done(Error("Execution timeout"))},_progressHandler(e,t){t.loaded=t.loaded||t.position;const r=t.lengthComputable?Math.ceil(100*t.loaded/t.total):0;this.set({state:{executing:!0,uploading:"upload"===e&&r<100,processing:"upload"===e&&100===r,downloading:"download"===e},[e+"Progress"]:{position:t.loaded,total:t.total,percent:r}}),this.dispatchEvent(e,{lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total})}}),dmx.Component("if",{attributes:{condition:{type:Boolean,default:!1}},events:{show:Event,hide:Event},init(e){for(this._shown=!1,this._template=document.createDocumentFragment();e.firstChild;)this._template.appendChild(e.firstChild)},render(e){this.props.condition&&this._show()},performUpdate(e){this.props.condition?this._show():this._hide()},_show(){if(this._shown)return;const e=this._template.cloneNode(!0);this.$node.appendChild(e),this.$parse(),this.dispatchEvent("show"),this._shown=!0},_hide(){this._shown&&(Array.from(this.$node.childNodes).forEach((e=>{const t=new Event("remove",{cancelable:!0});e.dispatchEvent(t)&&e.remove()})),this.$destroyChildren(),this.dispatchEvent("hide"),this._shown=!1)}}),dmx.Component("datetime",{initialData:{datetime:null},attributes:{interval:{type:String,default:"seconds",enum:["seconds","minutes","hours","days"]},utc:{type:Boolean,default:!1}},init(){this._tick=this._tick.bind(this),this._tick()},_tick(){switch(this.set("datetime",this._datetime()),this.props.interval){case"seconds":return setTimeout(this._tick,1e3);case"minutes":return setTimeout(this._tick,6e4);case"hours":return setTimeout(this._tick,36e5);case"days":return setTimeout(this._tick,864e5);default:return requestAnimationFrame(this._tick)}},_datetime(){const e=new Date,t=(e,t)=>("0000"+e).slice(-t),r=this.props.utc,n=r?e.getUTCFullYear():e.getFullYear(),s=(r?e.getUTCMonth():e.getMonth())+1,i=r?e.getUTCDate():e.getDate(),a=r?e.getUTCHours():e.getHours(),o=r?e.getUTCMinutes():e.getMinutes(),d=r?e.getUTCSeconds():e.getSeconds(),h=t(n,4)+"-"+t(s,2)+"-"+t(i,2),l=r?"Z":"";switch(this.props.interval){case"days":return h+"T00:00:00"+l;case"hours":return h+"T"+t(a,2)+":00:00"+l;case"minutes":return h+"T"+t(a,2)+":"+t(o,2)+":00"+l}return h+"T"+t(a,2)+":"+t(o,2)+":"+t(d,2)+l}}),dmx.Component("api-action",{extends:"fetch"}),dmx.Component("api-form",{extends:"serverconnect-form"}),dmx.Component("array",{initialData:{items:[],count:0},attributes:{items:{type:Array,default:[]}},events:{updated:Event},methods:{add(e){this._splice(this._count(),0,e)},addUniq(e){-1==this._indexOf(e)&&this._splice(this._count(),0,e)},insert(e,t){this._splice(e,0,t)},insertBefore(e,t){const r=this._indexOf(e);-1!=r&&this._splice(r,0,t)},insertAfter(e,t){const r=this._indexOf(e);-1!=r&&this._splice(r+1,0,t)},replace(e,t){const r=this._indexOf(e);-1!=r&&this._splice(r,1,t)},replaceAt(e,t){this._splice(e,1,t)},remove(e){const t=this._indexOf(e);-1!=t&&this._splice(t,1)},removeAt(e){this._splice(e,1)},reverse(){this._reverse()},sort(){this._sort()},empty(){this._updateData([])}},render:!1,init(){const e=dmx.array(this.props.items);this.set({items:e,count:e.length})},performUpdate(e){e.has("items")&&this._updateData(dmx.array(this.props.items))},_count(){return this.data.items.length},_indexOf(e){return this.data.items.indexOf(e)},_splice(e,t,r){const n=dmx.clone(this.data.items);void 0!==r?n.splice(e,t,r):n.splice(e,t),this._updateData(n)},_reverse(){const e=dmx.clone(this.data.items);e.reverse(),this._updateData(e)},_sort(){const e=dmx.clone(this.data.items);e.sort(),this._updateData(e)},_updateData(e){dmx.equal(this.data.items,e)||(this.set({items:e,count:e.length}),this.dispatchEvent("updated"))}}),dmx.Component("group",{}),dmx.Component("flow",{initialData:{data:null,running:!1,lastError:null},attributes:{src:{type:String,default:null},preload:{type:Boolean,default:!1},autorun:{type:Boolean,default:!1},params:{type:Object,default:{}}},methods:{run(e,t){return this._run(e,t)},runSub(e){return this._runSub(e)}},events:{start:Event,done:Event,error:Event},render:!1,init(e){if(this.props.src)(this.props.preload||this.props.autorun)&&this._load(this.props.src,this.props.autorun).catch(console.error);else try{this._flow=this._parse(e.textContent),this.props.autorun&&this._run()}catch(e){console.error(e)}},destroy(){this._destroyed=!0},$parseAttributes(e){dmx.BaseComponent.prototype.$parseAttributes.call(this,e),dmx.dom.getAttributes(e).forEach((({name:e,argument:t,value:r})=>{t&&r&&"param"==e&&this.$watch(r,(e=>{this.props.params=Object.assign({},this.props.params,{[t]:e})}))}))},_load(e,t){return fetch(e).then((e=>{if(!e.ok||e.status>=400)throw Error(`Could not load flow ${this.name}, status ${e.status} ${e.statusText}`);return e.text()})).then((e=>{this._flow=this._parse(e),t&&this._run()}))},_parse:e=>(window.Hjson?Hjson:JSON).parse(e),_runSub(e){if(!this._flow){if(this.props.src)return this._load(this.props.src).then((()=>{this._runFlow(e)}));throw Error("No flow")}return this._runFlow(e)},_run(e,t){return this._flow?this.data.running?void console.info(`Can't run flow ${this.name} when a previous run didn't finish.`):(this.set({running:!0,lastError:null}),this.dispatchEvent("start"),this._runFlow(e).then((e=>(this.set({running:!1,data:e}),this.dispatchEvent("done"),e))).catch((e=>{if(this.set({running:!1,lastError:e&&e.message}),this.dispatchEvent("error"),t)throw e}))):this.props.src?this._load(this.props.src).then((()=>{this._run(e,t)})).catch(console.error):void console.warn(`Flow ${this.name} is missing.`)},_runFlow(e){return dmx.Flow.run(this._flow,dmx.DataScope({$param:Object.assign({},this.props.params,e)},this))}}),dmx.Component("toggle",{initialData:{checked:!1},attributes:{checked:{type:Boolean,default:!1}},methods:{check(){this.props.checked=!0},uncheck(){this.props.checked=!1},toggle(){this.props.checked=!this.data.checked}},events:{updated:Event},render:!1,init(e){this.set("checked",this.props.checked)},performUpdate(e){e.has("checked")&&(this.set("checked",this.props.checked),this.dispatchEvent("updated"))}}),dmx.Attribute("bind","mounted",(function(e,t){const r=t.argument,n=dmx.reToggleAttribute.test(r);this.$watch(t.value,(t=>{if(n)e.toggleAttribute(r,!!t);else{if("style"===r&&"object"==typeof t)return Object.assign(e.style,t);if(null==t)return e.removeAttribute(r);e.setAttribute(r,t),"src"===r&&("VIDEO"===e.nodeName||"AUDIO"===e.nodeName?e.load():"SOURCE"===e.nodeName&&e.parentNode&&e.parentNode.load())}}))})),dmx.Attribute("on","mounted",(function(e,t){const r=this;dmx.eventListener(e,t.argument,(function(e){e.originalEvent&&(e=e.originalEvent);return dmx.parse(t.value,dmx.DataScope({$event:e.$data,$originalEvent:e},r))}),t.modifiers)})),dmx.Attribute("repeat","before",(function(e,t){const r=document.createComment("Repeat Attribute"),n=document.createDocumentFragment(),s=dmx.Component("repeat-item");e.parentNode.replaceChild(r,e),e.removeAttribute(t.fullName),n.append(e);let i=[];this.$watch(t.value,(e=>{const a=dmx.repeatItems(e);if(a.length>1e4&&(console.warn("More than 10000 repeat items, we limit the result!"),a.length=1e4),t.modifiers.fast){if(i.length>a.length&&i.splice(a.length).forEach((e=>e.$destroy())),i.length&&i.forEach(((e,t)=>e.set(a[t]))),a.length>i.length){const e=document.createDocumentFragment();a.slice(i.length).forEach((t=>{const r=new s(n.cloneNode(!0),this,t);e.appendChild(r.$nodes[0]),r.$parse(r.$nodes[0]),i.push(r),this.$addChild(r)})),requestAnimationFrame((()=>{r.parentNode.insertBefore(e,r),this.set(t.argument,a)}))}}else{const e=document.createDocumentFragment();i.splice(0).forEach((e=>e.$destroy()));for(const t of a){const r=new s(n.cloneNode(!0),this,t);e.append(r.$nodes[0]),r.$parse(r.$nodes[0]),i.push(r),this.$addChild(r)}requestAnimationFrame((()=>{r.parentNode.insertBefore(e,r),this.set(t.argument,a)}))}}))})),dmx.Attribute("class","mounted",(function(e,t){this.$watch(t.value,(r=>{e.classList[r?"add":"remove"](t.argument)}))})),dmx.Attribute("hide","mounted",(function(e,t){const r={value:e.style.getPropertyValue("display"),priority:e.style.getPropertyPriority("display")};this.$watch(t.value,(t=>{const n=t?"none":r.value,s=t?"important":r.priority;e.style.setProperty("display",n,s)}))})),dmx.Attribute("show","mounted",(function(e,t){const r={value:e.style.getPropertyValue("display"),priority:e.style.getPropertyPriority("display")};this.$watch(t.value,(t=>{const n=t?r.value:"none",s=t?r.priority:"important";e.style.setProperty("display",n,s)}))})),dmx.Attribute("html","mounted",(function(e,t){this.$watch(t.value,(t=>{const r=null!=t?String(t):"";e.innerHTML=r}))})),dmx.Attribute("text","mounted",(function(e,t){this.$watch(t.value,(t=>{const r=null!=t?String(t):"";e.innerText=r}))})),dmx.Attribute("style","mounted",(function(e,t){const r=t.modifiers.important?"important":"";this.$watch(t.value,(n=>{null!=n&&e.style.setProperty(t.argument,n,r)}))})),dmx.Formatters("global",{json:function(e){return JSON.stringify(e)},log:function(e){return console.log(e),e},run:function(e,t){var r=dmx.DataScope({$param:t},this);dmx.Flow.run(e,r)}}),dmx.Actions({subflow(e){const t=this.parse(e.flow),r=this.parse(e.param);return this.parse(t+".runSub("+JSON.stringify(r)+")")},comment(e){dmx.debug&&console.debug(e.message)},wait(e){const t=this.parse(e.delay);if("number"!=typeof t)throw new Error("wait: Invalid delay");return new Promise((e=>{setTimeout(e,t)}))},now:e=>(new Date).toISOString(),random(e){let t=this.parse(e.lower),r=this.parse(e.upper),n=!!this.parse(e.floating);"number"==typeof t&&isFinite(t)||(t=0),"number"==typeof r&&isFinite(r)||(r=1);let s=t+Math.random()*(r-t);return n||Math.floor(t)!=t||Math.floor(r)!=r||(s=Math.round(s)),s},confirm(e){const t=this.parse(e.message);if("string"!=typeof t)throw new Error("confirm: Invalid message");const r=confirm(t);if(r){if(e.then)return this._exec(e.then).then((()=>r))}else if(e.else)return this._exec(e.else).then((()=>r));return r},prompt(e){const t=this.parse(e.message);if("string"!=typeof t)throw new Error("prompt: Invalid message");return prompt(t)},alert(e){const t=this.parse(e.message);if("string"!=typeof t)throw new Error("alert: Invalid message");return alert(t)},repeat(e){let t=dmx.clone(this.parse(e.repeat));if(!t)return;if("boolean"==typeof t)t=t?[0]:[];else if("string"==typeof t)t=t.split(/\s*,\s*/);else if("number"==typeof t){for(var r=[],n=0;n<t;n++)r.push(n+1);t=r}if("object"!=typeof t)throw new Error("repeat: data is not repeatable");const s=this.scope,i=this.output;return this._each(t,((t,r)=>(this.scope=new dmx.DataScope(Object.assign({$value:t,$index:r,$name:r,$key:r,$number:r+1,$oddeven:r%2},t),s),this.output={},Array.isArray(e.outputFields)&&t instanceof Object&&e.outputFields.forEach((e=>{this.output[e]=t[e]})),this._exec(e.exec).then((()=>{var e=this.output;return this.scope=s,this.output=i,e})))))},condition(e){const t=!!this.parse(e.if);if(t){if(e.then)return this._exec(e.then).then((()=>t))}else if(e.else)return this._exec(e.else).then((()=>t));return t},conditions(e){if(Array.isArray(e.conditions))for(let t=0;t<e.conditions.length;t++){const r=e.conditions[t];if(this.parse(r.when))return this._exec(r.then)}},select(e){const t=this.parse(e.expression);if(Array.isArray(e.cases))for(let r=0;r<e.cases.length;r++){const n=e.cases[r];if(this.parse(n.value)==t)return this._exec(n.exec)}},group(e){if(e.name){const t=this.output;return this.output={},this._exec(e.exec).then((()=>{var e=this.output;return self.output=t,e}))}return this._exec(e.exec)},while(e){const t=()=>new Promise((r=>{if(!this.parse(e.condition))return r();this._exec(e.exec).then(t).then(r)}));return t()},switch(e){const t=this.parse(e.expression);for(let r=0;r<e.cases.length;r++)if(this.parse(e.cases[r].case)===t)return this._exec(e.cases[r].exec);if(e.default)return this._exec(e.default)},tryCatch(e){return Promise.resolve(this._exec(e.try)).catch((()=>this._exec(e.catch)))},run(e){if(!e.action)throw new Error("run: missing action");return this.parse(e.action)},runJS(e){if(!e.function)throw new Error("runJS: missing function");const t=this.parse(e.function),r=this.parse(e.args);return window[t].apply(null,r)},assign(e){return this.parse(e.value)},setGlobal(e){const t=this.parse(e.key),r=this.parse(e.value);if("string"!=typeof t)throw new Error("setGlobal: key must be a string");return dmx.global.set(t,r),r},setSession(e){const t=this.parse(e.key),r=this.parse(e.value);if("string"!=typeof t)throw new Error("setSession: key must be a string");return sessionStorage.setItem(t,JSON.stringify(r)),r},getSession(e){const t=this.parse(e.key);if("string"!=typeof t)throw new Error("getSession: key must be a string");return JSON.parse(sessionStorage.getItem(t))},removeSession(e){const t=this.parse(e.key);if("string"!=typeof t)throw new Error("removeSession: key must be a string");return sessionStorage.removeItem(t),!0},setStorage(e){const t=this.parse(e.key),r=this.parse(e.value);if("string"!=typeof t)throw new Error("setStorage: key must be a string");return localStorage.setItem(t,JSON.stringify(r)),r},getStorage(e){const t=this.parse(e.key);if("string"!=typeof t)throw new Error("getStorage: key must be a string");return JSON.parse(localStorage.getItem(t))},removeStorage(e){const t=this.parse(e.key);if("string"!=typeof t)throw new Error("removeStorage: key must be a string");return localStorage.removeItem(t),!0},fetch(e){let t=this.parse(e.url),r=this.parse(e.method),n=this.parse(e.timeout),s=this.parse(e.dataType),i=this.parse(e.data),a=this.parse(e.params),o=this.parse(e.headers),d=this.parse(e.credentials),h=null;if("string"!=typeof t)throw new Error("fetch: invalid url "+t);if(["GET","POST","PUT","DELETE"].includes(r)||(r="GET"),["auto","json","text"].includes(s)||(s="auto"),"number"!=typeof n&&(n=0),o||(o={}),"object"==typeof a)for(var l in a)a.hasOwnProperty(l)&&null!=a[l]&&(t+=(-1!=t.indexOf("?")?"&":"?")+decodeURIComponent(l)+"="+decodeURIComponent(a[l]));if("GET"!=r)if("text"==s)o["Content-Type"]||(o["Content-Type"]="application/text"),h=i.toString();else if("json"==s)o["Content-Type"]||(o["Content-Type"]="application/json"),h=JSON.stringify(i);else if("POST"==r){if(h=new FormData,"object"==typeof i&&!Array.isArray(i))for(var u in i)if(i.hasOwnProperty(u)){var c=i[u];if(Array.isArray(c))for(var p in/\[\]$/.test(u)||(u+="[]"),c)c.hasOwnProperty(p)&&h.append(u,c[p]);else h.set(u,c)}}else o["Content-Type"]||(o["Content-Type"]="application/text"),h=i.toString();return new Promise(((e,s)=>{var i=new XMLHttpRequest;for(var a in i.onerror=s,i.onabort=s,i.ontimeout=s,i.onload=function(){var t=i.responseText,r=i.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((function(e,t){var r=t.split(": "),n=r.shift(),s=r.join(": ");return e[n.toLowerCase()]=s,e}),{});/^application\/json/.test(r["content-type"])&&(t=JSON.parse(t)),e({status:i.status,headers:r,data:t})},i.open(r,t),i.timeout=1e3*n,o)o.hasOwnProperty(a)&&i.setRequestHeader(a,o[a]);d&&(i.withCredentials=!0),i.send(h)}))}}),dmx.__actions.setValue=dmx.__actions.assign,dmx.__actions.api=dmx.__actions.fetch,dmx.__actions["api.send"]=dmx.__actions.fetch,dmx.__actions.serverConnect=dmx.__actions.fetch,dmx.Actions({"collections.addColumns":function(e){var t=this.parse(e.collection),r=e.add,n=!!this.parse(e.overwrite);if(!t.length)return[];for(var s=[],i=0,a=t.length;i<a;i++){var o=dmx.clone(t[i]);for(var d in r)if(r.hasOwnProperty(d)){var h=new dmx.DataScope(o,this.scope);(n||null==o[d])&&(o[d]=dmx.parse(r[d],h))}s.push(o)}return s},"collections.filterColumns":function(e){var t=this.parse(e.collection),r=this.parse(e.columns),n=!!this.parse(e.keep);if(!t.length)return[];for(var s=[],i=0,a=t.length;i<a;i++){var o=t[i],d={};for(var h in o)o.hasOwnProperty(h)&&(r.includes(h)?n&&(d[h]=dmx.clone(o[h])):n||(d[h]=dmx.clone(o[h])));s.push(d)}return s},"collections.renameColumns":function(e){var t=this.parse(e.collection),r=this.parse(e.rename);if(!t.length)return[];for(var n=[],s=0,i=t.length;s<i;s++){var a=t[s],o={};for(var d in a)a.hasOwnProperty(d)&&(o[r[d]||d]=dmx.clone(a[d]));n.push(o)}return n},"collections.fillDown":function(e){var t=this.parse(e.collection),r=this.parse(e.columns);if(!t.length)return[];for(var n=[],s={},i=0,a=r.length;i<a;i++)s[r[i]]=null;for(i=0,a=t.length;i<a;i++){var o=dmx.clone(t[i]);for(var d in s)s.hasOwnProperty(d)&&(null==o[d]?o[d]=s[d]:s[d]=o[d]);n.push(o)}return n},"collections.addRows":function(e){var t=this.parse(e.collection),r=this.parse(e.rows);return dmx.clone(t).concat(dmx.clone(r))},"collections.addRowNumbers":function(e){for(var t=this.parse(e.collection),r=this.parse(e.column),n=this.parse(e.startAt),s=!!this.parse(e.desc),i=[],a=0,o=t.length;a<o;a++){var d=dmx.clone(t[a]);d[r]=s?o+n-a:n+a,i.push(d)}return i},"colections.join":function(e){for(var t=this.parse(e.collection1),r=this.parse(e.collection2),n=this.parse(e.matches),s=!!this.parse(e.matchAll),i=[],a=0,o=t.length;a<o;a++){for(var d=dmx.clone(t[a]),h=0,l=r.length;h<l;h++){var u=r[h],c=!1;for(var p in n)if(n.hasOwnProperty(p))if(d[p]==u[n[p]]){if(c=!0,!s)break}else if(s){c=!1;break}if(c){for(var f in u)u.hasOwnProperty(f)&&(d[f]=dmx.clone(u[f]));break}}i.push(d)}return i},"collections.mormalize":function(e){for(var t=this.parse(e.collection),r=[],n=[],s=0,i=t.length;s<i;s++)for(var a in t[s])t[s].hasOwnProperty(a)&&-1==r.indexOf(a)&&r.push(a);for(s=0,i=t.length;s<i;s++){for(var o={},d=0,h=r.length;d<h;d++){a=r[d];var l=dmx.clone(t[a]);o[a]=null!=l?l:null}n.push(o)}return n}}),dmx.Actions({"console.log":function(e){console.log(this.parse(e.message))},"console.info":function(e){console.info(this.parse(e.message))},"console.warn":function(e){console.warn(this.parse(e.message))},"console.error":function(e){console.error(this.parse(e.message))},"console.count":function(e){console.count(this.parse(e.label))},"console.time":function(e){console.time(this.parse(e.label))},"console.timeEnd":function(e){console.timeEnd(this.parse(e.label))},"console.group":function(e){console.group()},"console.groupEnd":function(e){console.groupEnd()},"console.clear":function(e){console.clear()}});
//# sourceMappingURL=dmxAppConnect.js.map
